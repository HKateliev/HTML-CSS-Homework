{"ast":null,"code":"'use strict';\n\nvar path = require('path');\nvar writeFileAtomic = require('write-file-atomic');\nvar moduleName = require('../utils/module-name.js');\nvar deepSortObject = require('../utils/deep-sort-object.js');\nvar sortedObject = require('sorted-object');\nvar isWindows = require('../utils/is-windows.js');\nvar sortKeys = ['dependencies', 'devDependencies', 'bundleDependencies', 'optionalDependencies', 'keywords', 'engines', 'scripts', 'files'];\nmodule.exports = function (mod, buildpath, next) {\n  var pkg = sortedObject(mod.package);\n  var name = moduleName(mod);\n  // Add our diagnostic keys to the package.json.\n  // Note that there are folks relying on these, for ex, the Visual Studio\n  // Node.js addon.\n  pkg._requiredBy = mod.requiredBy.map(function (req) {\n    if (req.package.devDependencies && req.package.devDependencies[name] && !req.package.dependencies[name]) {\n      return '#DEV:' + req.location;\n    } else {\n      return req.location;\n    }\n  }).concat(mod.userRequired ? ['#USER'] : []).sort();\n  pkg._location = mod.location;\n  pkg._phantomChildren = {};\n  Object.keys(mod.phantomChildren).sort().forEach(function (name) {\n    pkg._phantomChildren[name] = mod.phantomChildren[name].package.version;\n  });\n  pkg._inBundle = !!mod.fromBundle;\n\n  // sort keys that are known safe to sort to produce more consistent output\n  sortKeys.forEach(function (key) {\n    if (pkg[key] != null) pkg[key] = deepSortObject(pkg[key]);\n  });\n  var data = JSON.stringify(sortedObject(pkg), null, 2) + '\\n';\n  writeFileAtomic(path.resolve(buildpath, 'package.json'), data, {\n    // We really don't need this guarantee, and fsyncing here is super slow. Except on\n    // Windows where there isn't a big performance difference and it prevents errors when\n    // rolling back optional packages (#17671)\n    fsync: isWindows\n  }, next);\n};","map":{"version":3,"names":["path","require","writeFileAtomic","moduleName","deepSortObject","sortedObject","isWindows","sortKeys","module","exports","mod","buildpath","next","pkg","package","name","_requiredBy","requiredBy","map","req","devDependencies","dependencies","location","concat","userRequired","sort","_location","_phantomChildren","Object","keys","phantomChildren","forEach","version","_inBundle","fromBundle","key","data","JSON","stringify","resolve","fsync"],"sources":["/Users/hkateliev/node_modules/npm/lib/install/update-package-json.js"],"sourcesContent":["'use strict'\nvar path = require('path')\nvar writeFileAtomic = require('write-file-atomic')\nvar moduleName = require('../utils/module-name.js')\nvar deepSortObject = require('../utils/deep-sort-object.js')\nvar sortedObject = require('sorted-object')\nvar isWindows = require('../utils/is-windows.js')\n\nvar sortKeys = [\n  'dependencies', 'devDependencies', 'bundleDependencies',\n  'optionalDependencies', 'keywords', 'engines', 'scripts',\n  'files'\n]\n\nmodule.exports = function (mod, buildpath, next) {\n  var pkg = sortedObject(mod.package)\n  var name = moduleName(mod)\n  // Add our diagnostic keys to the package.json.\n  // Note that there are folks relying on these, for ex, the Visual Studio\n  // Node.js addon.\n  pkg._requiredBy =\n    mod.requiredBy\n      .map(function (req) {\n        if (\n          req.package.devDependencies &&\n          req.package.devDependencies[name] &&\n          !req.package.dependencies[name]\n        ) {\n          return '#DEV:' + req.location\n        } else {\n          return req.location\n        }\n      })\n      .concat(mod.userRequired ? ['#USER'] : [])\n      .sort()\n  pkg._location = mod.location\n  pkg._phantomChildren = {}\n  Object.keys(mod.phantomChildren).sort().forEach(function (name) {\n    pkg._phantomChildren[name] = mod.phantomChildren[name].package.version\n  })\n  pkg._inBundle = !!mod.fromBundle\n\n  // sort keys that are known safe to sort to produce more consistent output\n  sortKeys.forEach(function (key) {\n    if (pkg[key] != null) pkg[key] = deepSortObject(pkg[key])\n  })\n\n  var data = JSON.stringify(sortedObject(pkg), null, 2) + '\\n'\n\n  writeFileAtomic(path.resolve(buildpath, 'package.json'), data, {\n    // We really don't need this guarantee, and fsyncing here is super slow. Except on\n    // Windows where there isn't a big performance difference and it prevents errors when\n    // rolling back optional packages (#17671)\n    fsync: isWindows\n  }, next)\n}\n"],"mappings":"AAAA,YAAY;;AACZ,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;AAC1B,IAAIC,eAAe,GAAGD,OAAO,CAAC,mBAAmB,CAAC;AAClD,IAAIE,UAAU,GAAGF,OAAO,CAAC,yBAAyB,CAAC;AACnD,IAAIG,cAAc,GAAGH,OAAO,CAAC,8BAA8B,CAAC;AAC5D,IAAII,YAAY,GAAGJ,OAAO,CAAC,eAAe,CAAC;AAC3C,IAAIK,SAAS,GAAGL,OAAO,CAAC,wBAAwB,CAAC;AAEjD,IAAIM,QAAQ,GAAG,CACb,cAAc,EAAE,iBAAiB,EAAE,oBAAoB,EACvD,sBAAsB,EAAE,UAAU,EAAE,SAAS,EAAE,SAAS,EACxD,OAAO,CACR;AAEDC,MAAM,CAACC,OAAO,GAAG,UAAUC,GAAG,EAAEC,SAAS,EAAEC,IAAI,EAAE;EAC/C,IAAIC,GAAG,GAAGR,YAAY,CAACK,GAAG,CAACI,OAAO,CAAC;EACnC,IAAIC,IAAI,GAAGZ,UAAU,CAACO,GAAG,CAAC;EAC1B;EACA;EACA;EACAG,GAAG,CAACG,WAAW,GACbN,GAAG,CAACO,UAAU,CACXC,GAAG,CAAC,UAAUC,GAAG,EAAE;IAClB,IACEA,GAAG,CAACL,OAAO,CAACM,eAAe,IAC3BD,GAAG,CAACL,OAAO,CAACM,eAAe,CAACL,IAAI,CAAC,IACjC,CAACI,GAAG,CAACL,OAAO,CAACO,YAAY,CAACN,IAAI,CAAC,EAC/B;MACA,OAAO,OAAO,GAAGI,GAAG,CAACG,QAAQ;IAC/B,CAAC,MAAM;MACL,OAAOH,GAAG,CAACG,QAAQ;IACrB;EACF,CAAC,CAAC,CACDC,MAAM,CAACb,GAAG,CAACc,YAAY,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CACzCC,IAAI,EAAE;EACXZ,GAAG,CAACa,SAAS,GAAGhB,GAAG,CAACY,QAAQ;EAC5BT,GAAG,CAACc,gBAAgB,GAAG,CAAC,CAAC;EACzBC,MAAM,CAACC,IAAI,CAACnB,GAAG,CAACoB,eAAe,CAAC,CAACL,IAAI,EAAE,CAACM,OAAO,CAAC,UAAUhB,IAAI,EAAE;IAC9DF,GAAG,CAACc,gBAAgB,CAACZ,IAAI,CAAC,GAAGL,GAAG,CAACoB,eAAe,CAACf,IAAI,CAAC,CAACD,OAAO,CAACkB,OAAO;EACxE,CAAC,CAAC;EACFnB,GAAG,CAACoB,SAAS,GAAG,CAAC,CAACvB,GAAG,CAACwB,UAAU;;EAEhC;EACA3B,QAAQ,CAACwB,OAAO,CAAC,UAAUI,GAAG,EAAE;IAC9B,IAAItB,GAAG,CAACsB,GAAG,CAAC,IAAI,IAAI,EAAEtB,GAAG,CAACsB,GAAG,CAAC,GAAG/B,cAAc,CAACS,GAAG,CAACsB,GAAG,CAAC,CAAC;EAC3D,CAAC,CAAC;EAEF,IAAIC,IAAI,GAAGC,IAAI,CAACC,SAAS,CAACjC,YAAY,CAACQ,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG,IAAI;EAE5DX,eAAe,CAACF,IAAI,CAACuC,OAAO,CAAC5B,SAAS,EAAE,cAAc,CAAC,EAAEyB,IAAI,EAAE;IAC7D;IACA;IACA;IACAI,KAAK,EAAElC;EACT,CAAC,EAAEM,IAAI,CAAC;AACV,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}