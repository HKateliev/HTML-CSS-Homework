{"ast":null,"code":"// XXX this can probably be replaced with gentle-fs.mkdir everywhere it's used\nconst chownr = require('chownr');\nconst inflight = require('inflight');\nconst log = require('npmlog');\nconst mkdirp = require('mkdirp');\nconst inferOwner = require('infer-owner');\n\n// retain ownership of the parent dir\n// this matches behavior in cacache to infer the cache ownership\n// based on the ownership of the cache folder or it is parent.\n\nmodule.exports = function correctMkdir(path, cb) {\n  cb = inflight('correctMkdir: ' + path, cb);\n  if (!cb) {\n    return log.verbose('correctMkdir', path, 'correctMkdir already in flight; waiting');\n  } else {\n    log.verbose('correctMkdir', path, 'correctMkdir not in flight; initializing');\n  }\n  if (!process.getuid) {\n    log.verbose('makeCacheDir', 'UID & GID are irrelevant on', process.platform);\n    return mkdirp(path, (er, made) => cb(er, {\n      uid: 0,\n      gid: 0\n    }));\n  }\n  inferOwner(path).then(owner => {\n    mkdirp(path, (er, made) => {\n      if (er) {\n        log.error('correctMkdir', 'failed to make directory %s', path);\n        return cb(er);\n      }\n      chownr(made || path, owner.uid, owner.gid, er => cb(er, owner));\n    });\n  }, er => {\n    log.error('correctMkdir', 'failed to infer path ownership %s', path);\n    return cb(er);\n  });\n};","map":{"version":3,"names":["chownr","require","inflight","log","mkdirp","inferOwner","module","exports","correctMkdir","path","cb","verbose","process","getuid","platform","er","made","uid","gid","then","owner","error"],"sources":["/Users/hkateliev/node_modules/npm/lib/utils/correct-mkdir.js"],"sourcesContent":["// XXX this can probably be replaced with gentle-fs.mkdir everywhere it's used\nconst chownr = require('chownr')\nconst inflight = require('inflight')\nconst log = require('npmlog')\nconst mkdirp = require('mkdirp')\nconst inferOwner = require('infer-owner')\n\n// retain ownership of the parent dir\n// this matches behavior in cacache to infer the cache ownership\n// based on the ownership of the cache folder or it is parent.\n\nmodule.exports = function correctMkdir (path, cb) {\n  cb = inflight('correctMkdir: ' + path, cb)\n  if (!cb) {\n    return log.verbose('correctMkdir', path, 'correctMkdir already in flight; waiting')\n  } else {\n    log.verbose('correctMkdir', path, 'correctMkdir not in flight; initializing')\n  }\n\n  if (!process.getuid) {\n    log.verbose('makeCacheDir', 'UID & GID are irrelevant on', process.platform)\n    return mkdirp(path, (er, made) => cb(er, { uid: 0, gid: 0 }))\n  }\n\n  inferOwner(path).then(owner => {\n    mkdirp(path, (er, made) => {\n      if (er) {\n        log.error('correctMkdir', 'failed to make directory %s', path)\n        return cb(er)\n      }\n      chownr(made || path, owner.uid, owner.gid, (er) => cb(er, owner))\n    })\n  }, er => {\n    log.error('correctMkdir', 'failed to infer path ownership %s', path)\n    return cb(er)\n  })\n}\n"],"mappings":"AAAA;AACA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMC,QAAQ,GAAGD,OAAO,CAAC,UAAU,CAAC;AACpC,MAAME,GAAG,GAAGF,OAAO,CAAC,QAAQ,CAAC;AAC7B,MAAMG,MAAM,GAAGH,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMI,UAAU,GAAGJ,OAAO,CAAC,aAAa,CAAC;;AAEzC;AACA;AACA;;AAEAK,MAAM,CAACC,OAAO,GAAG,SAASC,YAAYA,CAAEC,IAAI,EAAEC,EAAE,EAAE;EAChDA,EAAE,GAAGR,QAAQ,CAAC,gBAAgB,GAAGO,IAAI,EAAEC,EAAE,CAAC;EAC1C,IAAI,CAACA,EAAE,EAAE;IACP,OAAOP,GAAG,CAACQ,OAAO,CAAC,cAAc,EAAEF,IAAI,EAAE,yCAAyC,CAAC;EACrF,CAAC,MAAM;IACLN,GAAG,CAACQ,OAAO,CAAC,cAAc,EAAEF,IAAI,EAAE,0CAA0C,CAAC;EAC/E;EAEA,IAAI,CAACG,OAAO,CAACC,MAAM,EAAE;IACnBV,GAAG,CAACQ,OAAO,CAAC,cAAc,EAAE,6BAA6B,EAAEC,OAAO,CAACE,QAAQ,CAAC;IAC5E,OAAOV,MAAM,CAACK,IAAI,EAAE,CAACM,EAAE,EAAEC,IAAI,KAAKN,EAAE,CAACK,EAAE,EAAE;MAAEE,GAAG,EAAE,CAAC;MAAEC,GAAG,EAAE;IAAE,CAAC,CAAC,CAAC;EAC/D;EAEAb,UAAU,CAACI,IAAI,CAAC,CAACU,IAAI,CAACC,KAAK,IAAI;IAC7BhB,MAAM,CAACK,IAAI,EAAE,CAACM,EAAE,EAAEC,IAAI,KAAK;MACzB,IAAID,EAAE,EAAE;QACNZ,GAAG,CAACkB,KAAK,CAAC,cAAc,EAAE,6BAA6B,EAAEZ,IAAI,CAAC;QAC9D,OAAOC,EAAE,CAACK,EAAE,CAAC;MACf;MACAf,MAAM,CAACgB,IAAI,IAAIP,IAAI,EAAEW,KAAK,CAACH,GAAG,EAAEG,KAAK,CAACF,GAAG,EAAGH,EAAE,IAAKL,EAAE,CAACK,EAAE,EAAEK,KAAK,CAAC,CAAC;IACnE,CAAC,CAAC;EACJ,CAAC,EAAEL,EAAE,IAAI;IACPZ,GAAG,CAACkB,KAAK,CAAC,cAAc,EAAE,mCAAmC,EAAEZ,IAAI,CAAC;IACpE,OAAOC,EAAE,CAACK,EAAE,CAAC;EACf,CAAC,CAAC;AACJ,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}