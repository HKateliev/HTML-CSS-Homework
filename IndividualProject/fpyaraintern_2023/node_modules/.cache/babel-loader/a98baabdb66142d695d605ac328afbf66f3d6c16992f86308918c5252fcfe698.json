{"ast":null,"code":"'use strict';\n\nconst fetch = require('npm-registry-fetch');\nconst fetchPackument = require('./packument');\nconst optCheck = require('../../util/opt-check');\nconst pickManifest = require('npm-pick-manifest');\nconst ssri = require('ssri');\nmodule.exports = manifest;\nfunction manifest(spec, opts) {\n  opts = optCheck(opts);\n  return getManifest(spec, opts).then(manifest => {\n    return annotateManifest(spec, manifest, opts);\n  });\n}\nfunction getManifest(spec, opts) {\n  opts = opts.concat({\n    fullMetadata: opts.enjoyBy ? true : opts.fullMetadata\n  });\n  return fetchPackument(spec, opts).then(packument => {\n    try {\n      return pickManifest(packument, spec.fetchSpec, {\n        defaultTag: opts.defaultTag,\n        enjoyBy: opts.enjoyBy,\n        includeDeprecated: opts.includeDeprecated\n      });\n    } catch (err) {\n      if ((err.code === 'ETARGET' || err.code === 'E403') && packument._cached && !opts.offline) {\n        opts.log.silly('registry:manifest', `no matching version for ${spec.name}@${spec.fetchSpec} in the cache. Forcing revalidation.`);\n        opts = opts.concat({\n          preferOffline: false,\n          preferOnline: true\n        });\n        return fetchPackument(spec, opts.concat({\n          // Fetch full metadata in case ETARGET was due to corgi delay\n          fullMetadata: true\n        })).then(packument => {\n          return pickManifest(packument, spec.fetchSpec, {\n            defaultTag: opts.defaultTag,\n            enjoyBy: opts.enjoyBy\n          });\n        });\n      } else {\n        throw err;\n      }\n    }\n  });\n}\nfunction annotateManifest(spec, manifest, opts) {\n  const shasum = manifest.dist && manifest.dist.shasum;\n  manifest._integrity = manifest.dist && manifest.dist.integrity;\n  manifest._shasum = shasum;\n  if (!manifest._integrity && shasum) {\n    // Use legacy dist.shasum field if available.\n    manifest._integrity = ssri.fromHex(shasum, 'sha1').toString();\n  }\n  manifest._resolved = manifest.dist && manifest.dist.tarball;\n  if (!manifest._resolved) {\n    const registry = fetch.pickRegistry(spec, opts);\n    const uri = registry.replace(/\\/?$/, '/') + spec.escapedName;\n    const err = new Error(`Manifest for ${manifest.name}@${manifest.version} from ${uri} is missing a tarball url (pkg.dist.tarball). Guessing a default.`);\n    err.code = 'ENOTARBALL';\n    err.manifest = manifest;\n    if (!manifest._warnings) {\n      manifest._warnings = [];\n    }\n    manifest._warnings.push(err.message);\n    manifest._resolved = `${registry}/${manifest.name}/-/${manifest.name}-${manifest.version}.tgz`;\n  }\n  return manifest;\n}","map":{"version":3,"names":["fetch","require","fetchPackument","optCheck","pickManifest","ssri","module","exports","manifest","spec","opts","getManifest","then","annotateManifest","concat","fullMetadata","enjoyBy","packument","fetchSpec","defaultTag","includeDeprecated","err","code","_cached","offline","log","silly","name","preferOffline","preferOnline","shasum","dist","_integrity","integrity","_shasum","fromHex","toString","_resolved","tarball","registry","pickRegistry","uri","replace","escapedName","Error","version","_warnings","push","message"],"sources":["/Users/hkateliev/node_modules/npm/node_modules/pacote/lib/fetchers/registry/manifest.js"],"sourcesContent":["'use strict'\n\nconst fetch = require('npm-registry-fetch')\nconst fetchPackument = require('./packument')\nconst optCheck = require('../../util/opt-check')\nconst pickManifest = require('npm-pick-manifest')\nconst ssri = require('ssri')\n\nmodule.exports = manifest\nfunction manifest (spec, opts) {\n  opts = optCheck(opts)\n\n  return getManifest(spec, opts).then(manifest => {\n    return annotateManifest(spec, manifest, opts)\n  })\n}\n\nfunction getManifest (spec, opts) {\n  opts = opts.concat({\n    fullMetadata: opts.enjoyBy ? true : opts.fullMetadata\n  })\n  return fetchPackument(spec, opts).then(packument => {\n    try {\n      return pickManifest(packument, spec.fetchSpec, {\n        defaultTag: opts.defaultTag,\n        enjoyBy: opts.enjoyBy,\n        includeDeprecated: opts.includeDeprecated\n      })\n    } catch (err) {\n      if ((err.code === 'ETARGET' || err.code === 'E403') && packument._cached && !opts.offline) {\n        opts.log.silly(\n          'registry:manifest',\n          `no matching version for ${spec.name}@${spec.fetchSpec} in the cache. Forcing revalidation.`\n        )\n        opts = opts.concat({\n          preferOffline: false,\n          preferOnline: true\n        })\n        return fetchPackument(spec, opts.concat({\n          // Fetch full metadata in case ETARGET was due to corgi delay\n          fullMetadata: true\n        })).then(packument => {\n          return pickManifest(packument, spec.fetchSpec, {\n            defaultTag: opts.defaultTag,\n            enjoyBy: opts.enjoyBy\n          })\n        })\n      } else {\n        throw err\n      }\n    }\n  })\n}\n\nfunction annotateManifest (spec, manifest, opts) {\n  const shasum = manifest.dist && manifest.dist.shasum\n  manifest._integrity = manifest.dist && manifest.dist.integrity\n  manifest._shasum = shasum\n  if (!manifest._integrity && shasum) {\n    // Use legacy dist.shasum field if available.\n    manifest._integrity = ssri.fromHex(shasum, 'sha1').toString()\n  }\n  manifest._resolved = (\n    manifest.dist && manifest.dist.tarball\n  )\n  if (!manifest._resolved) {\n    const registry = fetch.pickRegistry(spec, opts)\n    const uri = registry.replace(/\\/?$/, '/') + spec.escapedName\n\n    const err = new Error(\n      `Manifest for ${manifest.name}@${manifest.version} from ${uri} is missing a tarball url (pkg.dist.tarball). Guessing a default.`\n    )\n    err.code = 'ENOTARBALL'\n    err.manifest = manifest\n    if (!manifest._warnings) { manifest._warnings = [] }\n    manifest._warnings.push(err.message)\n    manifest._resolved =\n    `${registry}/${manifest.name}/-/${manifest.name}-${manifest.version}.tgz`\n  }\n  return manifest\n}\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,KAAK,GAAGC,OAAO,CAAC,oBAAoB,CAAC;AAC3C,MAAMC,cAAc,GAAGD,OAAO,CAAC,aAAa,CAAC;AAC7C,MAAME,QAAQ,GAAGF,OAAO,CAAC,sBAAsB,CAAC;AAChD,MAAMG,YAAY,GAAGH,OAAO,CAAC,mBAAmB,CAAC;AACjD,MAAMI,IAAI,GAAGJ,OAAO,CAAC,MAAM,CAAC;AAE5BK,MAAM,CAACC,OAAO,GAAGC,QAAQ;AACzB,SAASA,QAAQA,CAAEC,IAAI,EAAEC,IAAI,EAAE;EAC7BA,IAAI,GAAGP,QAAQ,CAACO,IAAI,CAAC;EAErB,OAAOC,WAAW,CAACF,IAAI,EAAEC,IAAI,CAAC,CAACE,IAAI,CAACJ,QAAQ,IAAI;IAC9C,OAAOK,gBAAgB,CAACJ,IAAI,EAAED,QAAQ,EAAEE,IAAI,CAAC;EAC/C,CAAC,CAAC;AACJ;AAEA,SAASC,WAAWA,CAAEF,IAAI,EAAEC,IAAI,EAAE;EAChCA,IAAI,GAAGA,IAAI,CAACI,MAAM,CAAC;IACjBC,YAAY,EAAEL,IAAI,CAACM,OAAO,GAAG,IAAI,GAAGN,IAAI,CAACK;EAC3C,CAAC,CAAC;EACF,OAAOb,cAAc,CAACO,IAAI,EAAEC,IAAI,CAAC,CAACE,IAAI,CAACK,SAAS,IAAI;IAClD,IAAI;MACF,OAAOb,YAAY,CAACa,SAAS,EAAER,IAAI,CAACS,SAAS,EAAE;QAC7CC,UAAU,EAAET,IAAI,CAACS,UAAU;QAC3BH,OAAO,EAAEN,IAAI,CAACM,OAAO;QACrBI,iBAAiB,EAAEV,IAAI,CAACU;MAC1B,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZ,IAAI,CAACA,GAAG,CAACC,IAAI,KAAK,SAAS,IAAID,GAAG,CAACC,IAAI,KAAK,MAAM,KAAKL,SAAS,CAACM,OAAO,IAAI,CAACb,IAAI,CAACc,OAAO,EAAE;QACzFd,IAAI,CAACe,GAAG,CAACC,KAAK,CACZ,mBAAmB,EAClB,2BAA0BjB,IAAI,CAACkB,IAAK,IAAGlB,IAAI,CAACS,SAAU,sCAAqC,CAC7F;QACDR,IAAI,GAAGA,IAAI,CAACI,MAAM,CAAC;UACjBc,aAAa,EAAE,KAAK;UACpBC,YAAY,EAAE;QAChB,CAAC,CAAC;QACF,OAAO3B,cAAc,CAACO,IAAI,EAAEC,IAAI,CAACI,MAAM,CAAC;UACtC;UACAC,YAAY,EAAE;QAChB,CAAC,CAAC,CAAC,CAACH,IAAI,CAACK,SAAS,IAAI;UACpB,OAAOb,YAAY,CAACa,SAAS,EAAER,IAAI,CAACS,SAAS,EAAE;YAC7CC,UAAU,EAAET,IAAI,CAACS,UAAU;YAC3BH,OAAO,EAAEN,IAAI,CAACM;UAChB,CAAC,CAAC;QACJ,CAAC,CAAC;MACJ,CAAC,MAAM;QACL,MAAMK,GAAG;MACX;IACF;EACF,CAAC,CAAC;AACJ;AAEA,SAASR,gBAAgBA,CAAEJ,IAAI,EAAED,QAAQ,EAAEE,IAAI,EAAE;EAC/C,MAAMoB,MAAM,GAAGtB,QAAQ,CAACuB,IAAI,IAAIvB,QAAQ,CAACuB,IAAI,CAACD,MAAM;EACpDtB,QAAQ,CAACwB,UAAU,GAAGxB,QAAQ,CAACuB,IAAI,IAAIvB,QAAQ,CAACuB,IAAI,CAACE,SAAS;EAC9DzB,QAAQ,CAAC0B,OAAO,GAAGJ,MAAM;EACzB,IAAI,CAACtB,QAAQ,CAACwB,UAAU,IAAIF,MAAM,EAAE;IAClC;IACAtB,QAAQ,CAACwB,UAAU,GAAG3B,IAAI,CAAC8B,OAAO,CAACL,MAAM,EAAE,MAAM,CAAC,CAACM,QAAQ,EAAE;EAC/D;EACA5B,QAAQ,CAAC6B,SAAS,GAChB7B,QAAQ,CAACuB,IAAI,IAAIvB,QAAQ,CAACuB,IAAI,CAACO,OAChC;EACD,IAAI,CAAC9B,QAAQ,CAAC6B,SAAS,EAAE;IACvB,MAAME,QAAQ,GAAGvC,KAAK,CAACwC,YAAY,CAAC/B,IAAI,EAAEC,IAAI,CAAC;IAC/C,MAAM+B,GAAG,GAAGF,QAAQ,CAACG,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,GAAGjC,IAAI,CAACkC,WAAW;IAE5D,MAAMtB,GAAG,GAAG,IAAIuB,KAAK,CAClB,gBAAepC,QAAQ,CAACmB,IAAK,IAAGnB,QAAQ,CAACqC,OAAQ,SAAQJ,GAAI,mEAAkE,CACjI;IACDpB,GAAG,CAACC,IAAI,GAAG,YAAY;IACvBD,GAAG,CAACb,QAAQ,GAAGA,QAAQ;IACvB,IAAI,CAACA,QAAQ,CAACsC,SAAS,EAAE;MAAEtC,QAAQ,CAACsC,SAAS,GAAG,EAAE;IAAC;IACnDtC,QAAQ,CAACsC,SAAS,CAACC,IAAI,CAAC1B,GAAG,CAAC2B,OAAO,CAAC;IACpCxC,QAAQ,CAAC6B,SAAS,GACjB,GAAEE,QAAS,IAAG/B,QAAQ,CAACmB,IAAK,MAAKnB,QAAQ,CAACmB,IAAK,IAAGnB,QAAQ,CAACqC,OAAQ,MAAK;EAC3E;EACA,OAAOrC,QAAQ;AACjB"},"metadata":{},"sourceType":"script","externalDependencies":[]}