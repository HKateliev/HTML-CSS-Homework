{"ast":null,"code":"'use strict';\n\nconst BB = require('bluebird');\nconst fs = require('graceful-fs');\nconst iferr = require('iferr');\nconst inflateShrinkwrap = require('./inflate-shrinkwrap.js');\nconst log = require('npmlog');\nconst parseJSON = require('../utils/parse-json.js');\nconst path = require('path');\nconst PKGLOCK_VERSION = require('../npm.js').lockfileVersion;\nconst readFileAsync = BB.promisify(fs.readFile);\nmodule.exports = readShrinkwrap;\nfunction readShrinkwrap(child, next) {\n  if (child.package._shrinkwrap) return process.nextTick(next);\n  BB.join(maybeReadFile('npm-shrinkwrap.json', child),\n  // Don't read non-root lockfiles\n  child.isTop && maybeReadFile('package-lock.json', child), (shrinkwrap, lockfile) => {\n    if (shrinkwrap && lockfile) {\n      log.warn('read-shrinkwrap', 'Ignoring package-lock.json because there is already an npm-shrinkwrap.json. Please use only one of the two.');\n    }\n    const name = shrinkwrap ? 'npm-shrinkwrap.json' : 'package-lock.json';\n    const parsed = parsePkgLock(shrinkwrap || lockfile, name);\n    if (parsed && parsed.lockfileVersion !== PKGLOCK_VERSION) {\n      log.warn('read-shrinkwrap', `This version of npm is compatible with lockfileVersion@${PKGLOCK_VERSION}, but ${name} was generated for lockfileVersion@${parsed.lockfileVersion || 0}. I'll try to do my best with it!`);\n    }\n    child.package._shrinkwrap = parsed;\n  }).then(() => next(), next);\n}\nfunction maybeReadFile(name, child) {\n  return readFileAsync(path.join(child.path, name), 'utf8').catch({\n    code: 'ENOENT'\n  }, () => null);\n}\nmodule.exports.andInflate = function (child, next) {\n  readShrinkwrap(child, iferr(next, function () {\n    if (child.package._shrinkwrap) {\n      return inflateShrinkwrap(child, child.package._shrinkwrap || {}, next);\n    } else {\n      return next();\n    }\n  }));\n};\nconst PARENT_RE = /\\|{7,}/g;\nconst OURS_RE = /<{7,}/g;\nconst THEIRS_RE = /={7,}/g;\nconst END_RE = />{7,}/g;\nmodule.exports._isDiff = isDiff;\nfunction isDiff(str) {\n  return str.match(OURS_RE) && str.match(THEIRS_RE) && str.match(END_RE);\n}\nmodule.exports._parsePkgLock = parsePkgLock;\nfunction parsePkgLock(str, filename) {\n  if (!str) {\n    return null;\n  }\n  try {\n    return parseJSON(str);\n  } catch (e) {\n    if (isDiff(str)) {\n      log.warn('conflict', `A git conflict was detected in ${filename}. Attempting to auto-resolve.`);\n      log.warn('conflict', 'To make this happen automatically on git rebase/merge, consider using the npm-merge-driver:');\n      log.warn('conflict', '$ npx npm-merge-driver install -g');\n      const pieces = str.split(/[\\n\\r]+/g).reduce((acc, line) => {\n        if (line.match(PARENT_RE)) acc.state = 'parent';else if (line.match(OURS_RE)) acc.state = 'ours';else if (line.match(THEIRS_RE)) acc.state = 'theirs';else if (line.match(END_RE)) acc.state = 'top';else {\n          if (acc.state === 'top' || acc.state === 'ours') acc.ours += line;\n          if (acc.state === 'top' || acc.state === 'theirs') acc.theirs += line;\n          if (acc.state === 'top' || acc.state === 'parent') acc.parent += line;\n        }\n        return acc;\n      }, {\n        state: 'top',\n        ours: '',\n        theirs: '',\n        parent: ''\n      });\n      try {\n        const ours = parseJSON(pieces.ours);\n        const theirs = parseJSON(pieces.theirs);\n        return reconcileLockfiles(ours, theirs);\n      } catch (_e) {\n        log.error('conflict', `Automatic conflict resolution failed. Please manually resolve conflicts in ${filename} and try again.`);\n        log.silly('conflict', `Error during resolution: ${_e}`);\n        throw e;\n      }\n    } else {\n      throw e;\n    }\n  }\n}\nfunction reconcileLockfiles(parent, ours, theirs) {\n  return Object.assign({}, ours, theirs);\n}","map":{"version":3,"names":["BB","require","fs","iferr","inflateShrinkwrap","log","parseJSON","path","PKGLOCK_VERSION","lockfileVersion","readFileAsync","promisify","readFile","module","exports","readShrinkwrap","child","next","package","_shrinkwrap","process","nextTick","join","maybeReadFile","isTop","shrinkwrap","lockfile","warn","name","parsed","parsePkgLock","then","catch","code","andInflate","PARENT_RE","OURS_RE","THEIRS_RE","END_RE","_isDiff","isDiff","str","match","_parsePkgLock","filename","e","pieces","split","reduce","acc","line","state","ours","theirs","parent","reconcileLockfiles","_e","error","silly","Object","assign"],"sources":["/Users/hkateliev/node_modules/npm/lib/install/read-shrinkwrap.js"],"sourcesContent":["'use strict'\n\nconst BB = require('bluebird')\n\nconst fs = require('graceful-fs')\nconst iferr = require('iferr')\nconst inflateShrinkwrap = require('./inflate-shrinkwrap.js')\nconst log = require('npmlog')\nconst parseJSON = require('../utils/parse-json.js')\nconst path = require('path')\nconst PKGLOCK_VERSION = require('../npm.js').lockfileVersion\n\nconst readFileAsync = BB.promisify(fs.readFile)\n\nmodule.exports = readShrinkwrap\nfunction readShrinkwrap (child, next) {\n  if (child.package._shrinkwrap) return process.nextTick(next)\n  BB.join(\n    maybeReadFile('npm-shrinkwrap.json', child),\n    // Don't read non-root lockfiles\n    child.isTop && maybeReadFile('package-lock.json', child),\n    (shrinkwrap, lockfile) => {\n      if (shrinkwrap && lockfile) {\n        log.warn('read-shrinkwrap', 'Ignoring package-lock.json because there is already an npm-shrinkwrap.json. Please use only one of the two.')\n      }\n      const name = shrinkwrap ? 'npm-shrinkwrap.json' : 'package-lock.json'\n      const parsed = parsePkgLock(shrinkwrap || lockfile, name)\n      if (parsed && parsed.lockfileVersion !== PKGLOCK_VERSION) {\n        log.warn('read-shrinkwrap', `This version of npm is compatible with lockfileVersion@${PKGLOCK_VERSION}, but ${name} was generated for lockfileVersion@${parsed.lockfileVersion || 0}. I'll try to do my best with it!`)\n      }\n      child.package._shrinkwrap = parsed\n    }\n  ).then(() => next(), next)\n}\n\nfunction maybeReadFile (name, child) {\n  return readFileAsync(\n    path.join(child.path, name),\n    'utf8'\n  ).catch({code: 'ENOENT'}, () => null)\n}\n\nmodule.exports.andInflate = function (child, next) {\n  readShrinkwrap(child, iferr(next, function () {\n    if (child.package._shrinkwrap) {\n      return inflateShrinkwrap(child, child.package._shrinkwrap || {}, next)\n    } else {\n      return next()\n    }\n  }))\n}\n\nconst PARENT_RE = /\\|{7,}/g\nconst OURS_RE = /<{7,}/g\nconst THEIRS_RE = /={7,}/g\nconst END_RE = />{7,}/g\n\nmodule.exports._isDiff = isDiff\nfunction isDiff (str) {\n  return str.match(OURS_RE) && str.match(THEIRS_RE) && str.match(END_RE)\n}\n\nmodule.exports._parsePkgLock = parsePkgLock\nfunction parsePkgLock (str, filename) {\n  if (!str) { return null }\n  try {\n    return parseJSON(str)\n  } catch (e) {\n    if (isDiff(str)) {\n      log.warn('conflict', `A git conflict was detected in ${filename}. Attempting to auto-resolve.`)\n      log.warn('conflict', 'To make this happen automatically on git rebase/merge, consider using the npm-merge-driver:')\n      log.warn('conflict', '$ npx npm-merge-driver install -g')\n      const pieces = str.split(/[\\n\\r]+/g).reduce((acc, line) => {\n        if (line.match(PARENT_RE)) acc.state = 'parent'\n        else if (line.match(OURS_RE)) acc.state = 'ours'\n        else if (line.match(THEIRS_RE)) acc.state = 'theirs'\n        else if (line.match(END_RE)) acc.state = 'top'\n        else {\n          if (acc.state === 'top' || acc.state === 'ours') acc.ours += line\n          if (acc.state === 'top' || acc.state === 'theirs') acc.theirs += line\n          if (acc.state === 'top' || acc.state === 'parent') acc.parent += line\n        }\n        return acc\n      }, {\n        state: 'top',\n        ours: '',\n        theirs: '',\n        parent: ''\n      })\n      try {\n        const ours = parseJSON(pieces.ours)\n        const theirs = parseJSON(pieces.theirs)\n        return reconcileLockfiles(ours, theirs)\n      } catch (_e) {\n        log.error('conflict', `Automatic conflict resolution failed. Please manually resolve conflicts in ${filename} and try again.`)\n        log.silly('conflict', `Error during resolution: ${_e}`)\n        throw e\n      }\n    } else {\n      throw e\n    }\n  }\n}\n\nfunction reconcileLockfiles (parent, ours, theirs) {\n  return Object.assign({}, ours, theirs)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}