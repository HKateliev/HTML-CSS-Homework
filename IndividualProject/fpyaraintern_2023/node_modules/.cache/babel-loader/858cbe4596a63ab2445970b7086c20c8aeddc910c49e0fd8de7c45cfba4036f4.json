{"ast":null,"code":"'use strict';\n\nvar validate = require('aproba');\nvar npm = require('../npm.js');\nmodule.exports = function (differences, decomposed, next) {\n  validate('AAF', arguments);\n  differences.forEach(action => {\n    var cmd = action[0];\n    var pkg = action[1];\n    switch (cmd) {\n      case 'add':\n        addSteps(decomposed, pkg);\n        break;\n      case 'update':\n        updateSteps(decomposed, pkg);\n        break;\n      case 'move':\n        moveSteps(decomposed, pkg);\n        break;\n      case 'remove':\n        removeSteps(decomposed, pkg);\n        break;\n      default:\n        defaultSteps(decomposed, cmd, pkg);\n    }\n  });\n  next();\n};\nfunction addAction(decomposed, action, pkg) {\n  if (decomposed.some(_ => _[0] === action && _[1] === pkg)) return;\n  decomposed.push([action, pkg]);\n}\nfunction addSteps(decomposed, pkg) {\n  if (pkg.fromBundle) {\n    // make sure our source module exists to extract ourselves from\n    // if we're installing our source module anyway, the duplication\n    // of these steps will be elided by `addAction` automatically\n    addAction(decomposed, 'fetch', pkg.fromBundle);\n    addAction(decomposed, 'extract', pkg.fromBundle);\n  }\n  if (!pkg.fromBundle && !pkg.isLink) {\n    addAction(decomposed, 'fetch', pkg);\n    addAction(decomposed, 'extract', pkg);\n  }\n  if (!pkg.fromBundle || npm.config.get('rebuild-bundle')) {\n    addAction(decomposed, 'preinstall', pkg);\n    addAction(decomposed, 'build', pkg);\n    addAction(decomposed, 'install', pkg);\n    addAction(decomposed, 'postinstall', pkg);\n  }\n  if (!pkg.fromBundle || !pkg.isLink) {\n    addAction(decomposed, 'finalize', pkg);\n  }\n  addAction(decomposed, 'refresh-package-json', pkg);\n}\nfunction updateSteps(decomposed, pkg) {\n  removeSteps(decomposed, pkg.oldPkg);\n  addSteps(decomposed, pkg);\n}\nfunction removeSteps(decomposed, pkg) {\n  addAction(decomposed, 'unbuild', pkg);\n  addAction(decomposed, 'remove', pkg);\n}\nfunction moveSteps(decomposed, pkg) {\n  addAction(decomposed, 'move', pkg);\n  addAction(decomposed, 'build', pkg);\n  addAction(decomposed, 'install', pkg);\n  addAction(decomposed, 'postinstall', pkg);\n  addAction(decomposed, 'refresh-package-json', pkg);\n}\nfunction defaultSteps(decomposed, cmd, pkg) {\n  addAction(decomposed, cmd, pkg);\n}","map":{"version":3,"names":["validate","require","npm","module","exports","differences","decomposed","next","arguments","forEach","action","cmd","pkg","addSteps","updateSteps","moveSteps","removeSteps","defaultSteps","addAction","some","_","push","fromBundle","isLink","config","get","oldPkg"],"sources":["/Users/hkateliev/node_modules/npm/lib/install/decompose-actions.js"],"sourcesContent":["'use strict'\nvar validate = require('aproba')\nvar npm = require('../npm.js')\n\nmodule.exports = function (differences, decomposed, next) {\n  validate('AAF', arguments)\n  differences.forEach((action) => {\n    var cmd = action[0]\n    var pkg = action[1]\n    switch (cmd) {\n      case 'add':\n        addSteps(decomposed, pkg)\n        break\n      case 'update':\n        updateSteps(decomposed, pkg)\n        break\n      case 'move':\n        moveSteps(decomposed, pkg)\n        break\n      case 'remove':\n        removeSteps(decomposed, pkg)\n        break\n      default:\n        defaultSteps(decomposed, cmd, pkg)\n    }\n  })\n  next()\n}\n\nfunction addAction (decomposed, action, pkg) {\n  if (decomposed.some((_) => _[0] === action && _[1] === pkg)) return\n  decomposed.push([action, pkg])\n}\n\nfunction addSteps (decomposed, pkg) {\n  if (pkg.fromBundle) {\n    // make sure our source module exists to extract ourselves from\n    // if we're installing our source module anyway, the duplication\n    // of these steps will be elided by `addAction` automatically\n    addAction(decomposed, 'fetch', pkg.fromBundle)\n    addAction(decomposed, 'extract', pkg.fromBundle)\n  }\n  if (!pkg.fromBundle && !pkg.isLink) {\n    addAction(decomposed, 'fetch', pkg)\n    addAction(decomposed, 'extract', pkg)\n  }\n  if (!pkg.fromBundle || npm.config.get('rebuild-bundle')) {\n    addAction(decomposed, 'preinstall', pkg)\n    addAction(decomposed, 'build', pkg)\n    addAction(decomposed, 'install', pkg)\n    addAction(decomposed, 'postinstall', pkg)\n  }\n  if (!pkg.fromBundle || !pkg.isLink) {\n    addAction(decomposed, 'finalize', pkg)\n  }\n  addAction(decomposed, 'refresh-package-json', pkg)\n}\n\nfunction updateSteps (decomposed, pkg) {\n  removeSteps(decomposed, pkg.oldPkg)\n  addSteps(decomposed, pkg)\n}\n\nfunction removeSteps (decomposed, pkg) {\n  addAction(decomposed, 'unbuild', pkg)\n  addAction(decomposed, 'remove', pkg)\n}\n\nfunction moveSteps (decomposed, pkg) {\n  addAction(decomposed, 'move', pkg)\n  addAction(decomposed, 'build', pkg)\n  addAction(decomposed, 'install', pkg)\n  addAction(decomposed, 'postinstall', pkg)\n  addAction(decomposed, 'refresh-package-json', pkg)\n}\n\nfunction defaultSteps (decomposed, cmd, pkg) {\n  addAction(decomposed, cmd, pkg)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}