{"ast":null,"code":"'use strict';\n\nconst Bluebird = require('bluebird');\nconst checkPlatform = Bluebird.promisify(require('npm-install-checks').checkPlatform);\nconst getRequested = require('../get-requested.js');\nconst npm = require('../../npm.js');\nconst path = require('path');\nconst readJson = Bluebird.promisify(require('read-package-json'));\nconst updatePackageJson = Bluebird.promisify(require('../update-package-json'));\nmodule.exports = function (staging, pkg, log) {\n  log.silly('refresh-package-json', pkg.realpath);\n  return readJson(path.join(pkg.path, 'package.json'), false).then(metadata => {\n    Object.keys(pkg.package).forEach(function (key) {\n      if (key !== 'version' && key !== 'dependencies' && !isEmpty(pkg.package[key])) {\n        metadata[key] = pkg.package[key];\n      }\n    });\n    if (metadata._resolved == null && pkg.fakeChild) {\n      metadata._resolved = pkg.fakeChild.resolved;\n    }\n    // These two sneak in and it's awful\n    delete metadata.readme;\n    delete metadata.readmeFilename;\n    pkg.package = metadata;\n    pkg.fakeChild = false;\n  }).catch(() => 'ignore').then(() => {\n    return checkPlatform(pkg.package, npm.config.get('force'));\n  }).then(() => {\n    const requested = pkg.package._requested || getRequested(pkg);\n    if (requested.type !== 'directory') {\n      return updatePackageJson(pkg, pkg.path);\n    }\n  });\n};\nfunction isEmpty(value) {\n  if (value == null) return true;\n  if (Array.isArray(value)) return !value.length;\n  if (typeof value === 'object') return !Object.keys(value).length;\n  return false;\n}","map":{"version":3,"names":["Bluebird","require","checkPlatform","promisify","getRequested","npm","path","readJson","updatePackageJson","module","exports","staging","pkg","log","silly","realpath","join","then","metadata","Object","keys","package","forEach","key","isEmpty","_resolved","fakeChild","resolved","readme","readmeFilename","catch","config","get","requested","_requested","type","value","Array","isArray","length"],"sources":["/Users/hkateliev/node_modules/npm/lib/install/action/refresh-package-json.js"],"sourcesContent":["'use strict'\n\nconst Bluebird = require('bluebird')\n\nconst checkPlatform = Bluebird.promisify(require('npm-install-checks').checkPlatform)\nconst getRequested = require('../get-requested.js')\nconst npm = require('../../npm.js')\nconst path = require('path')\nconst readJson = Bluebird.promisify(require('read-package-json'))\nconst updatePackageJson = Bluebird.promisify(require('../update-package-json'))\n\nmodule.exports = function (staging, pkg, log) {\n  log.silly('refresh-package-json', pkg.realpath)\n\n  return readJson(path.join(pkg.path, 'package.json'), false).then((metadata) => {\n    Object.keys(pkg.package).forEach(function (key) {\n      if (key !== 'version' && key !== 'dependencies' && !isEmpty(pkg.package[key])) {\n        metadata[key] = pkg.package[key]\n      }\n    })\n    if (metadata._resolved == null && pkg.fakeChild) {\n      metadata._resolved = pkg.fakeChild.resolved\n    }\n    // These two sneak in and it's awful\n    delete metadata.readme\n    delete metadata.readmeFilename\n\n    pkg.package = metadata\n    pkg.fakeChild = false\n  }).catch(() => 'ignore').then(() => {\n    return checkPlatform(pkg.package, npm.config.get('force'))\n  }).then(() => {\n    const requested = pkg.package._requested || getRequested(pkg)\n    if (requested.type !== 'directory') {\n      return updatePackageJson(pkg, pkg.path)\n    }\n  })\n}\n\nfunction isEmpty (value) {\n  if (value == null) return true\n  if (Array.isArray(value)) return !value.length\n  if (typeof value === 'object') return !Object.keys(value).length\n  return false\n}\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,aAAa,GAAGF,QAAQ,CAACG,SAAS,CAACF,OAAO,CAAC,oBAAoB,CAAC,CAACC,aAAa,CAAC;AACrF,MAAME,YAAY,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AACnD,MAAMI,GAAG,GAAGJ,OAAO,CAAC,cAAc,CAAC;AACnC,MAAMK,IAAI,GAAGL,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMM,QAAQ,GAAGP,QAAQ,CAACG,SAAS,CAACF,OAAO,CAAC,mBAAmB,CAAC,CAAC;AACjE,MAAMO,iBAAiB,GAAGR,QAAQ,CAACG,SAAS,CAACF,OAAO,CAAC,wBAAwB,CAAC,CAAC;AAE/EQ,MAAM,CAACC,OAAO,GAAG,UAAUC,OAAO,EAAEC,GAAG,EAAEC,GAAG,EAAE;EAC5CA,GAAG,CAACC,KAAK,CAAC,sBAAsB,EAAEF,GAAG,CAACG,QAAQ,CAAC;EAE/C,OAAOR,QAAQ,CAACD,IAAI,CAACU,IAAI,CAACJ,GAAG,CAACN,IAAI,EAAE,cAAc,CAAC,EAAE,KAAK,CAAC,CAACW,IAAI,CAAEC,QAAQ,IAAK;IAC7EC,MAAM,CAACC,IAAI,CAACR,GAAG,CAACS,OAAO,CAAC,CAACC,OAAO,CAAC,UAAUC,GAAG,EAAE;MAC9C,IAAIA,GAAG,KAAK,SAAS,IAAIA,GAAG,KAAK,cAAc,IAAI,CAACC,OAAO,CAACZ,GAAG,CAACS,OAAO,CAACE,GAAG,CAAC,CAAC,EAAE;QAC7EL,QAAQ,CAACK,GAAG,CAAC,GAAGX,GAAG,CAACS,OAAO,CAACE,GAAG,CAAC;MAClC;IACF,CAAC,CAAC;IACF,IAAIL,QAAQ,CAACO,SAAS,IAAI,IAAI,IAAIb,GAAG,CAACc,SAAS,EAAE;MAC/CR,QAAQ,CAACO,SAAS,GAAGb,GAAG,CAACc,SAAS,CAACC,QAAQ;IAC7C;IACA;IACA,OAAOT,QAAQ,CAACU,MAAM;IACtB,OAAOV,QAAQ,CAACW,cAAc;IAE9BjB,GAAG,CAACS,OAAO,GAAGH,QAAQ;IACtBN,GAAG,CAACc,SAAS,GAAG,KAAK;EACvB,CAAC,CAAC,CAACI,KAAK,CAAC,MAAM,QAAQ,CAAC,CAACb,IAAI,CAAC,MAAM;IAClC,OAAOf,aAAa,CAACU,GAAG,CAACS,OAAO,EAAEhB,GAAG,CAAC0B,MAAM,CAACC,GAAG,CAAC,OAAO,CAAC,CAAC;EAC5D,CAAC,CAAC,CAACf,IAAI,CAAC,MAAM;IACZ,MAAMgB,SAAS,GAAGrB,GAAG,CAACS,OAAO,CAACa,UAAU,IAAI9B,YAAY,CAACQ,GAAG,CAAC;IAC7D,IAAIqB,SAAS,CAACE,IAAI,KAAK,WAAW,EAAE;MAClC,OAAO3B,iBAAiB,CAACI,GAAG,EAAEA,GAAG,CAACN,IAAI,CAAC;IACzC;EACF,CAAC,CAAC;AACJ,CAAC;AAED,SAASkB,OAAOA,CAAEY,KAAK,EAAE;EACvB,IAAIA,KAAK,IAAI,IAAI,EAAE,OAAO,IAAI;EAC9B,IAAIC,KAAK,CAACC,OAAO,CAACF,KAAK,CAAC,EAAE,OAAO,CAACA,KAAK,CAACG,MAAM;EAC9C,IAAI,OAAOH,KAAK,KAAK,QAAQ,EAAE,OAAO,CAACjB,MAAM,CAACC,IAAI,CAACgB,KAAK,CAAC,CAACG,MAAM;EAChE,OAAO,KAAK;AACd"},"metadata":{},"sourceType":"script","externalDependencies":[]}