{"ast":null,"code":"'use strict';\n\nvar validate = require('aproba');\nvar asyncMap = require('slide').asyncMap;\nvar chain = require('slide').chain;\nvar npmInstallChecks = require('npm-install-checks');\nvar iferr = require('iferr');\nvar checkEngine = npmInstallChecks.checkEngine;\nvar checkPlatform = npmInstallChecks.checkPlatform;\nvar npm = require('../npm.js');\nmodule.exports = function (idealTree, args, next) {\n  validate('OAF', arguments);\n  var force = npm.config.get('force');\n  asyncMap(args, function (pkg, done) {\n    chain([[hasMinimumFields, pkg], [checkSelf, idealTree, pkg, force], [isInstallable, idealTree, pkg]], done);\n  }, next);\n};\nfunction hasMinimumFields(pkg, cb) {\n  if (pkg.name === '' || pkg.name == null) {\n    return cb(new Error(`Can't install ${pkg._resolved}: Missing package name`));\n  } else if (pkg.version === '' || pkg.version == null) {\n    return cb(new Error(`Can't install ${pkg._resolved}: Missing package version`));\n  } else {\n    return cb();\n  }\n}\nfunction setWarnings(idealTree, warn) {\n  function top(tree) {\n    if (tree.parent) return top(tree.parent);\n    return tree;\n  }\n  var topTree = top(idealTree);\n  if (!topTree.warnings) topTree.warnings = [];\n  if (topTree.warnings.every(i => i.code !== warn.code || i.required !== warn.required || i.pkgid !== warn.pkgid)) {\n    topTree.warnings.push(warn);\n  }\n}\nvar isInstallable = module.exports.isInstallable = function (idealTree, pkg, next) {\n  var force = npm.config.get('force');\n  var nodeVersion = npm.config.get('node-version');\n  if (/-/.test(nodeVersion)) {\n    // for the purposes of validation, if the node version is a prerelease,\n    // strip that. We check and warn about this sceanrio over in validate-tree.\n    nodeVersion = nodeVersion.replace(/-.*/, '');\n  }\n  var strict = npm.config.get('engine-strict');\n  checkEngine(pkg, npm.version, nodeVersion, force, strict, iferr(next, thenWarnEngineIssues));\n  function thenWarnEngineIssues(warn) {\n    if (idealTree && warn) setWarnings(idealTree, warn);\n    checkPlatform(pkg, force, next);\n  }\n};\nfunction checkSelf(idealTree, pkg, force, next) {\n  if (idealTree.package && idealTree.package.name !== pkg.name) return next();\n  if (force) {\n    var warn = new Error(\"Wouldn't install \" + pkg.name + ' as a dependency of itself, but being forced');\n    warn.code = 'ENOSELF';\n    idealTree.warnings.push(warn);\n    next();\n  } else {\n    var er = new Error('Refusing to install package with name \"' + pkg.name + '\" under a package\\n' + 'also called \"' + pkg.name + '\". Did you name your project the same\\n' + 'as the dependency you\\'re installing?\\n\\n' + 'For more information, see:\\n' + '    <https://docs.npmjs.com/cli/install#limitations-of-npms-install-algorithm>');\n    er.code = 'ENOSELF';\n    next(er);\n  }\n}","map":{"version":3,"names":["validate","require","asyncMap","chain","npmInstallChecks","iferr","checkEngine","checkPlatform","npm","module","exports","idealTree","args","next","arguments","force","config","get","pkg","done","hasMinimumFields","checkSelf","isInstallable","cb","name","Error","_resolved","version","setWarnings","warn","top","tree","parent","topTree","warnings","every","i","code","required","pkgid","push","nodeVersion","test","replace","strict","thenWarnEngineIssues","package","er"],"sources":["/Users/hkateliev/node_modules/npm/lib/install/validate-args.js"],"sourcesContent":["'use strict'\nvar validate = require('aproba')\nvar asyncMap = require('slide').asyncMap\nvar chain = require('slide').chain\nvar npmInstallChecks = require('npm-install-checks')\nvar iferr = require('iferr')\nvar checkEngine = npmInstallChecks.checkEngine\nvar checkPlatform = npmInstallChecks.checkPlatform\nvar npm = require('../npm.js')\n\nmodule.exports = function (idealTree, args, next) {\n  validate('OAF', arguments)\n  var force = npm.config.get('force')\n\n  asyncMap(args, function (pkg, done) {\n    chain([\n      [hasMinimumFields, pkg],\n      [checkSelf, idealTree, pkg, force],\n      [isInstallable, idealTree, pkg]\n    ], done)\n  }, next)\n}\n\nfunction hasMinimumFields (pkg, cb) {\n  if (pkg.name === '' || pkg.name == null) {\n    return cb(new Error(`Can't install ${pkg._resolved}: Missing package name`))\n  } else if (pkg.version === '' || pkg.version == null) {\n    return cb(new Error(`Can't install ${pkg._resolved}: Missing package version`))\n  } else {\n    return cb()\n  }\n}\n\nfunction setWarnings (idealTree, warn) {\n  function top (tree) {\n    if (tree.parent) return top(tree.parent)\n    return tree\n  }\n\n  var topTree = top(idealTree)\n  if (!topTree.warnings) topTree.warnings = []\n\n  if (topTree.warnings.every(i => (\n    i.code !== warn.code ||\n    i.required !== warn.required ||\n    i.pkgid !== warn.pkgid))) {\n    topTree.warnings.push(warn)\n  }\n}\n\nvar isInstallable = module.exports.isInstallable = function (idealTree, pkg, next) {\n  var force = npm.config.get('force')\n  var nodeVersion = npm.config.get('node-version')\n  if (/-/.test(nodeVersion)) {\n    // for the purposes of validation, if the node version is a prerelease,\n    // strip that. We check and warn about this sceanrio over in validate-tree.\n    nodeVersion = nodeVersion.replace(/-.*/, '')\n  }\n  var strict = npm.config.get('engine-strict')\n  checkEngine(pkg, npm.version, nodeVersion, force, strict, iferr(next, thenWarnEngineIssues))\n  function thenWarnEngineIssues (warn) {\n    if (idealTree && warn) setWarnings(idealTree, warn)\n    checkPlatform(pkg, force, next)\n  }\n}\n\nfunction checkSelf (idealTree, pkg, force, next) {\n  if (idealTree.package && idealTree.package.name !== pkg.name) return next()\n  if (force) {\n    var warn = new Error(\"Wouldn't install \" + pkg.name + ' as a dependency of itself, but being forced')\n    warn.code = 'ENOSELF'\n    idealTree.warnings.push(warn)\n    next()\n  } else {\n    var er = new Error('Refusing to install package with name \"' + pkg.name +\n     '\" under a package\\n' +\n     'also called \"' + pkg.name + '\". Did you name your project the same\\n' +\n     'as the dependency you\\'re installing?\\n\\n' +\n     'For more information, see:\\n' +\n     '    <https://docs.npmjs.com/cli/install#limitations-of-npms-install-algorithm>')\n    er.code = 'ENOSELF'\n    next(er)\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}