{"ast":null,"code":"'use strict';\n\n/* eslint-disable camelcase */\n/* eslint-disable standard/no-callback-literal */\n// npm install <pkg> <pkg> <pkg>\n//\n// See doc/cli/npm-install.md for more description\n//\n// Managing contexts...\n// there's a lot of state associated with an \"install\" operation, including\n// packages that are already installed, parent packages, current shrinkwrap, and\n// so on. We maintain this state in a \"context\" object that gets passed around.\n// every time we dive into a deeper node_modules folder, the \"family\" list that\n// gets passed along uses the previous \"family\" list as its __proto__.  Any\n// \"resolved precise dependency\" things that aren't already on this object get\n// added, and then that's passed to the next generation of installation.\nmodule.exports = install;\nmodule.exports.Installer = Installer;\nvar usage = require('./utils/usage');\ninstall.usage = usage('install', '\\nnpm install (with no args, in package dir)' + '\\nnpm install [<@scope>/]<pkg>' + '\\nnpm install [<@scope>/]<pkg>@<tag>' + '\\nnpm install [<@scope>/]<pkg>@<version>' + '\\nnpm install [<@scope>/]<pkg>@<version range>' + '\\nnpm install <alias>@npm:<name>' + '\\nnpm install <folder>' + '\\nnpm install <tarball file>' + '\\nnpm install <tarball url>' + '\\nnpm install <git:// url>' + '\\nnpm install <github username>/<github project>', '[--save-prod|--save-dev|--save-optional] [--save-exact] [--no-save]');\ninstall.completion = function (opts, cb) {\n  validate('OF', arguments);\n  // install can complete to a folder with a package.json, or any package.\n  // if it has a slash, then it's gotta be a folder\n  // if it starts with https?://, then just give up, because it's a url\n  if (/^https?:\\/\\//.test(opts.partialWord)) {\n    // do not complete to URLs\n    return cb(null, []);\n  }\n  if (/\\//.test(opts.partialWord)) {\n    // Complete fully to folder if there is exactly one match and it\n    // is a folder containing a package.json file.  If that is not the\n    // case we return 0 matches, which will trigger the default bash\n    // complete.\n    var lastSlashIdx = opts.partialWord.lastIndexOf('/');\n    var partialName = opts.partialWord.slice(lastSlashIdx + 1);\n    var partialPath = opts.partialWord.slice(0, lastSlashIdx);\n    if (partialPath === '') partialPath = '/';\n    var annotatePackageDirMatch = function (sibling, cb) {\n      var fullPath = path.join(partialPath, sibling);\n      if (sibling.slice(0, partialName.length) !== partialName) {\n        return cb(null, null); // not name match\n      }\n\n      fs.readdir(fullPath, function (err, contents) {\n        if (err) return cb(null, {\n          isPackage: false\n        });\n        cb(null, {\n          fullPath: fullPath,\n          isPackage: contents.indexOf('package.json') !== -1\n        });\n      });\n    };\n    return fs.readdir(partialPath, function (err, siblings) {\n      if (err) return cb(null, []); // invalid dir: no matching\n\n      asyncMap(siblings, annotatePackageDirMatch, function (err, matches) {\n        if (err) return cb(err);\n        var cleaned = matches.filter(function (x) {\n          return x !== null;\n        });\n        if (cleaned.length !== 1) return cb(null, []);\n        if (!cleaned[0].isPackage) return cb(null, []);\n\n        // Success - only one match and it is a package dir\n        return cb(null, [cleaned[0].fullPath]);\n      });\n    });\n  }\n\n  // FIXME: there used to be registry completion here, but it stopped making\n  // sense somewhere around 50,000 packages on the registry\n  cb();\n};\n\n// system packages\nvar fs = require('fs');\nvar path = require('path');\n\n// dependencies\nvar log = require('npmlog');\nvar readPackageTree = require('read-package-tree');\nvar readPackageJson = require('read-package-json');\nvar chain = require('slide').chain;\nvar asyncMap = require('slide').asyncMap;\nvar archy = require('archy');\nvar mkdirp = require('gentle-fs').mkdir;\nvar rimraf = require('rimraf');\nvar iferr = require('iferr');\nvar validate = require('aproba');\nvar uniq = require('lodash.uniq');\nvar Bluebird = require('bluebird');\n\n// npm internal utils\nvar npm = require('./npm.js');\nvar locker = require('./utils/locker.js');\nvar lock = locker.lock;\nvar unlock = locker.unlock;\nvar parseJSON = require('./utils/parse-json.js');\nvar output = require('./utils/output.js');\nvar saveMetrics = require('./utils/metrics.js').save;\n\n// install specific libraries\nvar copyTree = require('./install/copy-tree.js');\nvar readShrinkwrap = require('./install/read-shrinkwrap.js');\nvar computeMetadata = require('./install/deps.js').computeMetadata;\nvar prefetchDeps = require('./install/deps.js').prefetchDeps;\nvar loadDeps = require('./install/deps.js').loadDeps;\nvar loadDevDeps = require('./install/deps.js').loadDevDeps;\nvar getAllMetadata = require('./install/deps.js').getAllMetadata;\nvar loadRequestedDeps = require('./install/deps.js').loadRequestedDeps;\nvar loadExtraneous = require('./install/deps.js').loadExtraneous;\nvar diffTrees = require('./install/diff-trees.js');\nvar checkPermissions = require('./install/check-permissions.js');\nvar decomposeActions = require('./install/decompose-actions.js');\nvar validateTree = require('./install/validate-tree.js');\nvar validateArgs = require('./install/validate-args.js');\nvar saveRequested = require('./install/save.js').saveRequested;\nvar saveShrinkwrap = require('./install/save.js').saveShrinkwrap;\nvar audit = require('./install/audit.js');\nvar {\n  getPrintFundingReport,\n  getPrintFundingReportJSON\n} = require('./install/fund.js');\nvar getSaveType = require('./install/save.js').getSaveType;\nvar doSerialActions = require('./install/actions.js').doSerial;\nvar doReverseSerialActions = require('./install/actions.js').doReverseSerial;\nvar doParallelActions = require('./install/actions.js').doParallel;\nvar doOneAction = require('./install/actions.js').doOne;\nvar removeObsoleteDep = require('./install/deps.js').removeObsoleteDep;\nvar removeExtraneous = require('./install/deps.js').removeExtraneous;\nvar computeVersionSpec = require('./install/deps.js').computeVersionSpec;\nvar packageId = require('./utils/package-id.js');\nvar moduleName = require('./utils/module-name.js');\nvar errorMessage = require('./utils/error-message.js');\nvar isExtraneous = require('./install/is-extraneous.js');\nfunction unlockCB(lockPath, name, cb) {\n  validate('SSF', arguments);\n  return function (installEr) {\n    var args = arguments;\n    try {\n      unlock(lockPath, name, reportErrorAndReturn);\n    } catch (unlockEx) {\n      process.nextTick(function () {\n        reportErrorAndReturn(unlockEx);\n      });\n    }\n    function reportErrorAndReturn(unlockEr) {\n      if (installEr) {\n        if (unlockEr && unlockEr.code !== 'ENOTLOCKED') {\n          log.warn('unlock' + name, unlockEr);\n        }\n        return cb.apply(null, args);\n      }\n      if (unlockEr) return cb(unlockEr);\n      return cb.apply(null, args);\n    }\n  };\n}\nfunction install(where, args, cb) {\n  if (!cb) {\n    cb = args;\n    args = where;\n    where = null;\n  }\n  var globalTop = path.resolve(npm.globalDir, '..');\n  if (!where) {\n    where = npm.config.get('global') ? globalTop : npm.prefix;\n  }\n  validate('SAF', [where, args, cb]);\n  // the /path/to/node_modules/..\n  var dryrun = !!npm.config.get('dry-run');\n  if (npm.config.get('dev')) {\n    log.warn('install', 'Usage of the `--dev` option is deprecated. Use `--also=dev` instead.');\n  }\n  if (where === globalTop && !args.length) {\n    args = ['.'];\n  }\n  args = args.filter(function (a) {\n    return path.resolve(a) !== npm.prefix;\n  });\n  new Installer(where, dryrun, args).run(cb);\n}\nfunction Installer(where, dryrun, args, opts) {\n  validate('SBA|SBAO', arguments);\n  if (!opts) opts = {};\n  this.where = where;\n  this.dryrun = dryrun;\n  this.args = args;\n  // fakechildren are children created from the lockfile and lack relationship data\n  // the only exist when the tree does not match the lockfile\n  // this is fine when doing full tree installs/updates but not ok when modifying only\n  // a few deps via `npm install` or `npm uninstall`.\n  this.currentTree = null;\n  this.idealTree = null;\n  this.differences = [];\n  this.todo = [];\n  this.progress = {};\n  this.noPackageJsonOk = !!args.length;\n  this.topLevelLifecycles = !args.length;\n  this.autoPrune = npm.config.get('package-lock');\n  const dev = npm.config.get('dev');\n  const only = npm.config.get('only');\n  const onlyProd = /^prod(uction)?$/.test(only);\n  const onlyDev = /^dev(elopment)?$/.test(only);\n  const prod = npm.config.get('production');\n  this.dev = opts.dev != null ? opts.dev : dev || !onlyProd && !prod || onlyDev;\n  this.prod = opts.prod != null ? opts.prod : !onlyDev;\n  this.packageLockOnly = opts.packageLockOnly != null ? opts.packageLockOnly : npm.config.get('package-lock-only');\n  this.rollback = opts.rollback != null ? opts.rollback : npm.config.get('rollback');\n  this.link = opts.link != null ? opts.link : npm.config.get('link');\n  this.saveOnlyLock = opts.saveOnlyLock;\n  this.global = opts.global != null ? opts.global : this.where === path.resolve(npm.globalDir, '..');\n  this.audit = npm.config.get('audit') && !this.global;\n  this.fund = npm.config.get('fund') && !this.global;\n  this.started = Date.now();\n}\nInstaller.prototype = {};\nInstaller.prototype.run = function (_cb) {\n  validate('F|', arguments);\n  var result;\n  var cb;\n  if (_cb) {\n    cb = function (err) {\n      saveMetrics(!err);\n      return _cb.apply(this, arguments);\n    };\n  } else {\n    result = new Promise((resolve, reject) => {\n      cb = (err, value) => err ? reject(err) : resolve(value);\n    });\n  }\n  // FIXME: This is bad and I should feel bad.\n  // lib/install needs to have some way of sharing _limited_\n  // state with the things it calls. Passing the object is too\n  // much. The global config is WAY too much. =( =(\n  // But not having this is gonna break linked modules in\n  // subtle stupid ways, and refactoring all this code isn't\n  // the right thing to do just yet.\n  if (this.global) {\n    var prevGlobal = npm.config.get('global');\n    npm.config.set('global', true);\n    var next = cb;\n    cb = function () {\n      npm.config.set('global', prevGlobal);\n      next.apply(null, arguments);\n    };\n  }\n  var installSteps = [];\n  var postInstallSteps = [];\n  if (!this.dryrun) {\n    installSteps.push([this.newTracker(log, 'runTopLevelLifecycles', 2)], [this, this.runPreinstallTopLevelLifecycles]);\n  }\n  installSteps.push([this.newTracker(log, 'loadCurrentTree', 4)], [this, this.loadCurrentTree], [this, this.finishTracker, 'loadCurrentTree'], [this.newTracker(log, 'loadIdealTree', 12)], [this, this.loadIdealTree], [this, this.finishTracker, 'loadIdealTree'], [this, this.debugTree, 'currentTree', 'currentTree'], [this, this.debugTree, 'idealTree', 'idealTree'], [this.newTracker(log, 'generateActionsToTake')], [this, this.generateActionsToTake], [this, this.finishTracker, 'generateActionsToTake'], [this, this.debugActions, 'diffTrees', 'differences'], [this, this.debugActions, 'decomposeActions', 'todo'], [this, this.startAudit]);\n  if (this.packageLockOnly) {\n    postInstallSteps.push([this, this.saveToDependencies]);\n  } else if (!this.dryrun) {\n    installSteps.push([this.newTracker(log, 'executeActions', 8)], [this, this.executeActions], [this, this.finishTracker, 'executeActions']);\n    var node_modules = path.resolve(this.where, 'node_modules');\n    var staging = path.resolve(node_modules, '.staging');\n    postInstallSteps.push([this.newTracker(log, 'rollbackFailedOptional', 1)], [this, this.rollbackFailedOptional, staging, this.todo], [this, this.finishTracker, 'rollbackFailedOptional'], [this, this.commit, staging, this.todo], [this, this.runPostinstallTopLevelLifecycles], [this, this.finishTracker, 'runTopLevelLifecycles']);\n    if (getSaveType()) {\n      postInstallSteps.push(\n      // this is necessary as we don't fill in `dependencies` and `devDependencies` in deps loaded from shrinkwrap\n      // until after we extract them\n      [this, next => {\n        computeMetadata(this.idealTree);\n        next();\n      }], [this, this.pruneIdealTree], [this, this.debugLogicalTree, 'saveTree', 'idealTree'], [this, this.saveToDependencies]);\n    }\n  }\n  postInstallSteps.push([this, this.printWarnings], [this, this.printInstalled]);\n  var self = this;\n  chain(installSteps, function (installEr) {\n    if (installEr) self.failing = true;\n    chain(postInstallSteps, function (postInstallEr) {\n      if (installEr && postInstallEr) {\n        var msg = errorMessage(postInstallEr);\n        msg.summary.forEach(function (logline) {\n          log.warn.apply(log, logline);\n        });\n        msg.detail.forEach(function (logline) {\n          log.verbose.apply(log, logline);\n        });\n      }\n      cb(installEr || postInstallEr, self.getInstalledModules(), self.idealTree);\n    });\n  });\n  return result;\n};\nInstaller.prototype.loadArgMetadata = function (next) {\n  getAllMetadata(this.args, this.currentTree, process.cwd(), iferr(next, args => {\n    this.args = args;\n    next();\n  }));\n};\nInstaller.prototype.newTracker = function (tracker, name, size) {\n  validate('OS', [tracker, name]);\n  if (size) validate('N', [size]);\n  this.progress[name] = tracker.newGroup(name, size);\n  return function (next) {\n    process.emit('time', 'stage:' + name);\n    next();\n  };\n};\nInstaller.prototype.finishTracker = function (name, cb) {\n  validate('SF', arguments);\n  process.emit('timeEnd', 'stage:' + name);\n  cb();\n};\nInstaller.prototype.loadCurrentTree = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'loadCurrentTree');\n  var todo = [];\n  if (this.global) {\n    todo.push([this, this.readGlobalPackageData]);\n  } else {\n    todo.push([this, this.readLocalPackageData]);\n  }\n  todo.push([this, this.normalizeCurrentTree]);\n  chain(todo, cb);\n};\nvar createNode = require('./install/node.js').create;\nvar flatNameFromTree = require('./install/flatten-tree.js').flatNameFromTree;\nInstaller.prototype.normalizeCurrentTree = function (cb) {\n  this.currentTree.isTop = true;\n  normalizeTree(this.currentTree);\n  // If the user didn't have a package.json then fill in deps with what was on disk\n  if (this.currentTree.error) {\n    for (let child of this.currentTree.children) {\n      if (!child.fakeChild && isExtraneous(child)) {\n        this.currentTree.package.dependencies[moduleName(child)] = computeVersionSpec(this.currentTree, child);\n      }\n    }\n  }\n  computeMetadata(this.currentTree);\n  return cb();\n  function normalizeTree(tree, seen) {\n    if (!seen) seen = new Set();\n    if (seen.has(tree)) return;\n    seen.add(tree);\n    createNode(tree);\n    tree.location = flatNameFromTree(tree);\n    tree.children.forEach(child => normalizeTree(child, seen));\n  }\n};\nInstaller.prototype.loadIdealTree = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'loadIdealTree');\n  chain([[this.newTracker(this.progress.loadIdealTree, 'loadIdealTree:cloneCurrentTree')], [this, this.cloneCurrentTreeToIdealTree], [this, this.finishTracker, 'loadIdealTree:cloneCurrentTree'], [this.newTracker(this.progress.loadIdealTree, 'loadIdealTree:loadShrinkwrap')], [this, this.loadShrinkwrap], [this, this.finishTracker, 'loadIdealTree:loadShrinkwrap'], [this.newTracker(this.progress.loadIdealTree, 'loadIdealTree:loadAllDepsIntoIdealTree', 10)], [this, this.loadAllDepsIntoIdealTree], [this, this.finishTracker, 'loadIdealTree:loadAllDepsIntoIdealTree'], [this, function (next) {\n    computeMetadata(this.idealTree);\n    next();\n  }], [this, this.pruneIdealTree]], cb);\n};\nInstaller.prototype.pruneIdealTree = function (cb) {\n  if (!this.idealTree) return cb();\n  // if our lock file didn't have the requires field and there\n  // are any fake children then forgo pruning until we have more info.\n  if (!this.idealTree.hasRequiresFromLock && this.idealTree.children.some(n => n.fakeChild)) return cb();\n  const toPrune = this.idealTree.children.filter(child => isExtraneous(child) && (this.autoPrune || child.removing)).map(n => ({\n    name: moduleName(n)\n  }));\n  return removeExtraneous(toPrune, this.idealTree, cb);\n};\nInstaller.prototype.loadAllDepsIntoIdealTree = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'loadAllDepsIntoIdealTree');\n  var saveDeps = getSaveType();\n  var cg = this.progress['loadIdealTree:loadAllDepsIntoIdealTree'];\n  var installNewModules = !!this.args.length;\n  var steps = [];\n  if (installNewModules) {\n    steps.push([validateArgs, this.idealTree, this.args]);\n    steps.push([loadRequestedDeps, this.args, this.idealTree, saveDeps, cg.newGroup('loadRequestedDeps')]);\n  } else {\n    const depsToPreload = Object.assign({}, this.idealTree.package.devDependencies, this.idealTree.package.dependencies);\n    steps.push([prefetchDeps, this.idealTree, depsToPreload, cg.newGroup('prefetchDeps')], [loadDeps, this.idealTree, cg.newGroup('loadDeps')], [loadDevDeps, this.idealTree, cg.newGroup('loadDevDeps')]);\n  }\n  steps.push([loadExtraneous.andResolveDeps, this.idealTree, cg.newGroup('loadExtraneous')]);\n  chain(steps, cb);\n};\nInstaller.prototype.generateActionsToTake = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'generateActionsToTake');\n  var cg = this.progress.generateActionsToTake;\n  chain([[validateTree, this.idealTree, cg.newGroup('validateTree')], [diffTrees, this.currentTree, this.idealTree, this.differences, cg.newGroup('diffTrees')], [this, this.computeLinked], [checkPermissions, this.differences], [decomposeActions, this.differences, this.todo]], cb);\n};\nInstaller.prototype.computeLinked = function (cb) {\n  validate('F', arguments);\n  if (!this.link || this.global) return cb();\n  var linkTodoList = [];\n  var self = this;\n  asyncMap(this.differences, function (action, next) {\n    var cmd = action[0];\n    var pkg = action[1];\n    if (cmd !== 'add' && cmd !== 'update') return next();\n    var isReqByTop = pkg.requiredBy.filter(function (mod) {\n      return mod.isTop;\n    }).length;\n    var isReqByUser = pkg.userRequired;\n    var isExtraneous = pkg.requiredBy.length === 0;\n    if (!isReqByTop && !isReqByUser && !isExtraneous) return next();\n    isLinkable(pkg, function (install, link) {\n      if (install) linkTodoList.push(['global-install', pkg]);\n      if (link) linkTodoList.push(['global-link', pkg]);\n      if (install || link) removeObsoleteDep(pkg);\n      next();\n    });\n  }, function () {\n    if (linkTodoList.length === 0) return cb();\n    self.differences.length = 0;\n    Array.prototype.push.apply(self.differences, linkTodoList);\n    diffTrees(self.currentTree, self.idealTree, self.differences, log.newGroup('d2'), cb);\n  });\n};\nfunction isLinkable(pkg, cb) {\n  var globalPackage = path.resolve(npm.globalPrefix, 'lib', 'node_modules', moduleName(pkg));\n  var globalPackageJson = path.resolve(globalPackage, 'package.json');\n  fs.stat(globalPackage, function (er) {\n    if (er) return cb(true, true);\n    fs.readFile(globalPackageJson, function (er, data) {\n      var json = parseJSON.noExceptions(data);\n      cb(false, json && json.version === pkg.package.version);\n    });\n  });\n}\nInstaller.prototype.executeActions = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'executeActions');\n  var todo = this.todo;\n  var cg = this.progress.executeActions;\n  var node_modules = path.resolve(this.where, 'node_modules');\n  var staging = path.resolve(node_modules, '.staging');\n  var steps = [];\n  var trackLifecycle = cg.newGroup('lifecycle');\n  cb = unlockCB(node_modules, '.staging', cb);\n  steps.push([doSerialActions, 'global-install', staging, todo, trackLifecycle.newGroup('global-install')], [lock, node_modules, '.staging'], [rimraf, staging], [doParallelActions, 'extract', staging, todo, cg.newGroup('extract', 100)], [doReverseSerialActions, 'unbuild', staging, todo, cg.newGroup('unbuild')], [doSerialActions, 'remove', staging, todo, cg.newGroup('remove')], [doSerialActions, 'move', staging, todo, cg.newGroup('move')], [doSerialActions, 'finalize', staging, todo, cg.newGroup('finalize')], [doParallelActions, 'refresh-package-json', staging, todo, cg.newGroup('refresh-package-json')], [doParallelActions, 'preinstall', staging, todo, trackLifecycle.newGroup('preinstall')], [doSerialActions, 'build', staging, todo, trackLifecycle.newGroup('build')], [doSerialActions, 'global-link', staging, todo, trackLifecycle.newGroup('global-link')], [doParallelActions, 'update-linked', staging, todo, trackLifecycle.newGroup('update-linked')], [doSerialActions, 'install', staging, todo, trackLifecycle.newGroup('install')], [doSerialActions, 'postinstall', staging, todo, trackLifecycle.newGroup('postinstall')]);\n  var self = this;\n  chain(steps, function (er) {\n    if (!er || self.rollback) {\n      rimraf(staging, function () {\n        cb(er);\n      });\n    } else {\n      cb(er);\n    }\n  });\n};\nInstaller.prototype.rollbackFailedOptional = function (staging, actionsToRun, cb) {\n  if (!this.rollback) return cb();\n  var failed = uniq(actionsToRun.map(function (action) {\n    return action[1];\n  }).filter(function (pkg) {\n    return pkg.failed && pkg.rollback;\n  }));\n  var top = this.currentTree && this.currentTree.path;\n  Bluebird.map(failed, pkg => {\n    return Bluebird.map(pkg.rollback, rollback => rollback(top, staging, pkg));\n  }).asCallback(cb);\n};\nInstaller.prototype.commit = function (staging, actionsToRun, cb) {\n  var toCommit = actionsToRun.map(function (action) {\n    return action[1];\n  }).filter(function (pkg) {\n    return !pkg.failed && pkg.commit;\n  });\n  asyncMap(toCommit, function (pkg, next) {\n    asyncMap(pkg.commit, function (commit, done) {\n      commit(staging, pkg, done);\n    }, function () {\n      pkg.commit = [];\n      next.apply(null, arguments);\n    });\n  }, cb);\n};\nInstaller.prototype.runPreinstallTopLevelLifecycles = function (cb) {\n  validate('F', arguments);\n  if (this.failing) return cb();\n  if (!this.topLevelLifecycles) return cb();\n  log.silly('install', 'runPreinstallTopLevelLifecycles');\n  readPackageJson(path.join(this.where, 'package.json'), log, false, (err, data) => {\n    if (err) return cb();\n    this.currentTree = createNode({\n      isTop: true,\n      package: data,\n      path: this.where\n    });\n    doOneAction('preinstall', this.where, this.currentTree, log.newGroup('preinstall:.'), cb);\n  });\n};\nInstaller.prototype.runPostinstallTopLevelLifecycles = function (cb) {\n  validate('F', arguments);\n  if (this.failing) return cb();\n  if (!this.topLevelLifecycles) return cb();\n  log.silly('install', 'runPostinstallTopLevelLifecycles');\n  var steps = [];\n  var trackLifecycle = this.progress.runTopLevelLifecycles;\n  steps.push([doOneAction, 'build', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('build:.')], [doOneAction, 'install', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('install:.')], [doOneAction, 'postinstall', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('postinstall:.')]);\n  if (this.dev) {\n    steps.push([doOneAction, 'prepare', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('prepare')]);\n  }\n  chain(steps, cb);\n};\nInstaller.prototype.startAudit = function (cb) {\n  if (!this.audit) return cb();\n  this.auditSubmission = Bluebird.try(() => {\n    return audit.generateFromInstall(this.idealTree, this.differences, this.args, this.remove);\n  }).then(auditData => {\n    return audit.submitForInstallReport(auditData);\n  }).catch(_ => {});\n  cb();\n};\nInstaller.prototype.saveToDependencies = function (cb) {\n  validate('F', arguments);\n  if (this.failing) return cb();\n  log.silly('install', 'saveToDependencies');\n  // Note idealTree will be mutated during the save operations below as the\n  // package is reloaded from disk to preserve additional details. This means\n  // steps after postInstall will see a slightly different package object.\n  if (this.saveOnlyLock) {\n    saveShrinkwrap(this.idealTree, cb);\n  } else {\n    saveRequested(this.idealTree, cb);\n  }\n};\nInstaller.prototype.readGlobalPackageData = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'readGlobalPackageData');\n  var self = this;\n  this.loadArgMetadata(iferr(cb, function () {\n    mkdirp(self.where, iferr(cb, function () {\n      var pkgs = {};\n      self.args.forEach(function (pkg) {\n        pkgs[pkg.name] = true;\n      });\n      readPackageTree(self.where, function (ctx, kid) {\n        return ctx.parent || pkgs[kid];\n      }, iferr(cb, function (currentTree) {\n        self.currentTree = currentTree;\n        return cb();\n      }));\n    }));\n  }));\n};\nInstaller.prototype.readLocalPackageData = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'readLocalPackageData');\n  var self = this;\n  mkdirp(this.where, iferr(cb, function () {\n    readPackageTree(self.where, iferr(cb, function (currentTree) {\n      self.currentTree = currentTree;\n      self.currentTree.warnings = [];\n      if (currentTree.error && currentTree.error.code === 'EJSONPARSE') {\n        return cb(currentTree.error);\n      }\n      if (!self.noPackageJsonOk && !currentTree.package) {\n        log.error('install', \"Couldn't read dependencies\");\n        var er = new Error(\"ENOENT, open '\" + path.join(self.where, 'package.json') + \"'\");\n        er.code = 'ENOPACKAGEJSON';\n        er.errno = 34;\n        return cb(er);\n      }\n      if (!currentTree.package) currentTree.package = {};\n      readShrinkwrap(currentTree, function (err) {\n        if (err) {\n          cb(err);\n        } else {\n          self.loadArgMetadata(cb);\n        }\n      });\n    }));\n  }));\n};\nInstaller.prototype.cloneCurrentTreeToIdealTree = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'cloneCurrentTreeToIdealTree');\n  if (npm.config.get('before')) {\n    this.idealTree = {\n      package: this.currentTree.package,\n      path: this.currentTree.path,\n      realpath: this.currentTree.realpath,\n      children: [],\n      requires: [],\n      missingDeps: {},\n      missingDevDeps: {},\n      requiredBy: [],\n      error: this.currentTree.error,\n      warnings: [],\n      isTop: true\n    };\n  } else {\n    this.idealTree = copyTree(this.currentTree);\n    this.idealTree.warnings = [];\n  }\n  cb();\n};\nInstaller.prototype.loadShrinkwrap = function (cb) {\n  validate('F', arguments);\n  log.silly('install', 'loadShrinkwrap');\n  readShrinkwrap.andInflate(this.idealTree, iferr(cb, () => {\n    computeMetadata(this.idealTree);\n    cb();\n  }));\n};\nInstaller.prototype.getInstalledModules = function () {\n  return this.differences.filter(function (action) {\n    var mutation = action[0];\n    return mutation === 'add' || mutation === 'update';\n  }).map(function (action) {\n    var child = action[1];\n    return [child.package._id, child.path];\n  });\n};\nInstaller.prototype.printWarnings = function (cb) {\n  if (!this.idealTree) return cb();\n  var self = this;\n  var warned = false;\n  this.idealTree.warnings.forEach(function (warning) {\n    if (warning.code === 'EPACKAGEJSON' && self.global) return;\n    if (warning.code === 'ENOTDIR') return;\n    warned = true;\n    var msg = errorMessage(warning);\n    msg.summary.forEach(function (logline) {\n      log.warn.apply(log, logline);\n    });\n    msg.detail.forEach(function (logline) {\n      log.verbose.apply(log, logline);\n    });\n  });\n  if (warned && log.levels[npm.config.get('loglevel')] <= log.levels.warn) console.error();\n  cb();\n};\nInstaller.prototype.printInstalled = function (cb) {\n  validate('F', arguments);\n  if (this.failing) return cb();\n  log.silly('install', 'printInstalled');\n  const diffs = this.differences;\n  if (!this.idealTree.error && this.idealTree.removedChildren) {\n    const deps = this.currentTree.package.dependencies || {};\n    const dev = this.currentTree.package.devDependencies || {};\n    this.idealTree.removedChildren.forEach(r => {\n      if (diffs.some(d => d[0] === 'remove' && d[1].path === r.path)) return;\n      if (!deps[moduleName(r)] && !dev[moduleName(r)]) return;\n      diffs.push(['remove', r]);\n    });\n  }\n  return Bluebird.try(() => {\n    if (!this.auditSubmission) return;\n    return Bluebird.resolve(this.auditSubmission).timeout(10000).catch(() => null);\n  }).then(auditResult => {\n    if (auditResult && !auditResult.metadata) {\n      log.warn('audit', 'Audit result from registry missing metadata. This is probably an issue with the registry.');\n    }\n    // maybe write audit report w/ hash of pjson & shrinkwrap for later reading by `npm audit`\n    if (npm.config.get('json')) {\n      return this.printInstalledForJSON(diffs, auditResult);\n    } else if (npm.config.get('parseable')) {\n      return this.printInstalledForParseable(diffs, auditResult);\n    } else {\n      return this.printInstalledForHuman(diffs, auditResult);\n    }\n  }).asCallback(cb);\n};\nInstaller.prototype.printInstalledForHuman = function (diffs, auditResult) {\n  var removed = 0;\n  var added = 0;\n  var updated = 0;\n  var moved = 0;\n  // Count the number of contributors to packages added, tracking\n  // contributors we've seen, so we can produce a running unique count.\n  var contributors = new Set();\n  diffs.forEach(function (action) {\n    var mutation = action[0];\n    var pkg = action[1];\n    if (pkg.failed) return;\n    if (mutation === 'remove') {\n      ++removed;\n    } else if (mutation === 'move') {\n      ++moved;\n    } else if (mutation === 'add') {\n      ++added;\n      // Count contributors to added packages. Start by combining `author`\n      // and `contributors` data into a single array of contributor-people\n      // for this package.\n      var people = [];\n      var meta = pkg.package;\n      if (meta.author) people.push(meta.author);\n      if (meta.contributors && Array.isArray(meta.contributors)) {\n        people = people.concat(meta.contributors);\n      }\n      // Make sure a normalized string for every person behind this\n      // package is in `contributors`.\n      people.forEach(function (person) {\n        // Ignore errors from malformed `author` and `contributors`.\n        try {\n          var normalized = normalizePerson(person);\n        } catch (error) {\n          return;\n        }\n        if (!contributors.has(normalized)) contributors.add(normalized);\n      });\n    } else if (mutation === 'update' || mutation === 'update-linked') {\n      ++updated;\n    }\n  });\n  var report = '';\n  if (this.args.length && (added || updated)) {\n    report += this.args.map(p => {\n      return `+ ${p.name}@${p.version}${!p._requested.name || p._requested.name === p.name ? '' : ` (as ${p._requested.name})`}`;\n    }).join('\\n') + '\\n';\n  }\n  var actions = [];\n  if (added) {\n    var action = 'added ' + packages(added);\n    if (contributors.size) action += from(contributors.size);\n    actions.push(action);\n  }\n  if (removed) actions.push('removed ' + packages(removed));\n  if (updated) actions.push('updated ' + packages(updated));\n  if (moved) actions.push('moved ' + packages(moved));\n  if (auditResult && auditResult.metadata && auditResult.metadata.totalDependencies) {\n    actions.push('audited ' + packages(auditResult.metadata.totalDependencies));\n  }\n  if (actions.length === 0) {\n    report += 'up to date';\n  } else if (actions.length === 1) {\n    report += actions[0];\n  } else {\n    var lastAction = actions.pop();\n    report += actions.join(', ') + ' and ' + lastAction;\n  }\n  report += ' in ' + (Date.now() - this.started) / 1000 + 's';\n  output(report);\n  function packages(num) {\n    return num + ' package' + (num > 1 ? 's' : '');\n  }\n  function from(num) {\n    return ' from ' + num + ' contributor' + (num > 1 ? 's' : '');\n  }\n\n  // Values of `author` and elements of `contributors` in `package.json`\n  // files can be e-mail style strings or Objects with `name`, `email,\n  // and `url` String properties.  Convert Objects to Strings so that\n  // we can efficiently keep a set of contributors we have already seen.\n  function normalizePerson(argument) {\n    if (typeof argument === 'string') return argument;\n    var returned = '';\n    if (argument.name) returned += argument.name;\n    if (argument.email) returned += ' <' + argument.email + '>';\n    if (argument.url) returned += ' (' + argument.email + ')';\n    return returned;\n  }\n  const {\n    fund,\n    idealTree\n  } = this;\n  const printFundingReport = getPrintFundingReport({\n    fund,\n    idealTree\n  });\n  if (printFundingReport.length) {\n    output(printFundingReport);\n  }\n  if (auditResult) {\n    return audit.printInstallReport(auditResult);\n  }\n};\nInstaller.prototype.printInstalledForJSON = function (diffs, auditResult) {\n  const {\n    fund,\n    idealTree\n  } = this;\n  const printFundingReport = getPrintFundingReportJSON({\n    fund,\n    idealTree\n  });\n  var result = {\n    added: [],\n    removed: [],\n    updated: [],\n    moved: [],\n    failed: [],\n    warnings: [],\n    audit: auditResult,\n    funding: printFundingReport,\n    elapsed: Date.now() - this.started\n  };\n  var self = this;\n  this.idealTree.warnings.forEach(function (warning) {\n    if (warning.code === 'EPACKAGEJSON' && self.global) return;\n    if (warning.code === 'ENOTDIR') return;\n    var output = errorMessage(warning);\n    var message = flattenMessage(output.summary);\n    if (output.detail.length) {\n      message += '\\n' + flattenMessage(output.detail);\n    }\n    result.warnings.push(message);\n  });\n  diffs.forEach(function (action) {\n    var mutation = action[0];\n    var child = action[1];\n    var record = recordAction(action);\n    if (child.failed) {\n      result.failed.push(record);\n    } else if (mutation === 'add') {\n      result.added.push(record);\n    } else if (mutation === 'update' || mutation === 'update-linked') {\n      result.updated.push(record);\n    } else if (mutation === 'move') {\n      result.moved.push(record);\n    } else if (mutation === 'remove') {\n      result.removed.push(record);\n    }\n  });\n  output(JSON.stringify(result, null, 2));\n  function flattenMessage(msg) {\n    return msg.map(function (logline) {\n      return logline.slice(1).join(' ');\n    }).join('\\n');\n  }\n  function recordAction(action) {\n    var mutation = action[0];\n    var child = action[1];\n    const isAlias = child.package && child.package._requested && child.package._requested.type === 'alias';\n    const name = isAlias ? child.package._requested.name : child.package && child.package.name;\n    var result = {\n      action: mutation,\n      name,\n      version: child.package && `${isAlias ? `npm:${child.package.name}@` : ''}${child.package.version}`,\n      path: child.path\n    };\n    if (mutation === 'move') {\n      result.previousPath = child.fromPath;\n    } else if (mutation === 'update') {\n      result.previousVersion = child.oldPkg.package && child.oldPkg.package.version;\n    }\n    return result;\n  }\n};\nInstaller.prototype.printInstalledForParseable = function (diffs) {\n  var self = this;\n  diffs.forEach(function (action) {\n    var mutation = action[0];\n    var child = action[1];\n    if (mutation === 'move') {\n      var previousPath = path.relative(self.where, child.fromPath);\n    } else if (mutation === 'update') {\n      var previousVersion = child.oldPkg.package && child.oldPkg.package.version;\n    }\n    const isAlias = child.package._requested && child.package._requested.type === 'alias';\n    const version = child.package && isAlias ? `npm:${child.package.name}@${child.package.version}` : child.package ? child.package.version : '';\n    output(mutation + '\\t' + moduleName(child) + '\\t' + version + '\\t' + (child.path ? path.relative(self.where, child.path) : '') + '\\t' + (previousVersion || '') + '\\t' + (previousPath || ''));\n  });\n};\nInstaller.prototype.debugActions = function (name, actionListName, cb) {\n  validate('SSF', arguments);\n  var actionsToLog = this[actionListName];\n  log.silly(name, 'action count', actionsToLog.length);\n  actionsToLog.forEach(function (action) {\n    log.silly(name, action.map(function (value) {\n      return value && value.package ? packageId(value) : value;\n    }).join(' '));\n  });\n  cb();\n};\n\n// This takes an object and a property name instead of a value to allow us\n// to define the arguments for use by chain before the property exists yet.\nInstaller.prototype.debugTree = function (name, treeName, cb) {\n  validate('SSF', arguments);\n  log.silly(name, this.archyDebugTree(this[treeName]).trim());\n  cb();\n};\nInstaller.prototype.archyDebugTree = function (tree) {\n  validate('O', arguments);\n  var seen = new Set();\n  function byName(aa, bb) {\n    return packageId(aa).localeCompare(packageId(bb));\n  }\n  function expandTree(tree) {\n    seen.add(tree);\n    return {\n      label: packageId(tree),\n      nodes: tree.children.filter(tree => {\n        return !seen.has(tree) && !tree.removed;\n      }).sort(byName).map(expandTree)\n    };\n  }\n  return archy(expandTree(tree), '', {\n    unicode: npm.config.get('unicode')\n  });\n};\nInstaller.prototype.debugLogicalTree = function (name, treeName, cb) {\n  validate('SSF', arguments);\n  this[treeName] && log.silly(name, this.archyDebugLogicalTree(this[treeName]).trim());\n  cb();\n};\nInstaller.prototype.archyDebugLogicalTree = function (tree) {\n  validate('O', arguments);\n  var seen = new Set();\n  function byName(aa, bb) {\n    return packageId(aa).localeCompare(packageId(bb));\n  }\n  function expandTree(tree) {\n    seen.add(tree);\n    return {\n      label: packageId(tree),\n      nodes: tree.requires.filter(tree => {\n        return !seen.has(tree) && !tree.removed;\n      }).sort(byName).map(expandTree)\n    };\n  }\n  return archy(expandTree(tree), '', {\n    unicode: npm.config.get('unicode')\n  });\n};","map":{"version":3,"names":["module","exports","install","Installer","usage","require","completion","opts","cb","validate","arguments","test","partialWord","lastSlashIdx","lastIndexOf","partialName","slice","partialPath","annotatePackageDirMatch","sibling","fullPath","path","join","length","fs","readdir","err","contents","isPackage","indexOf","siblings","asyncMap","matches","cleaned","filter","x","log","readPackageTree","readPackageJson","chain","archy","mkdirp","mkdir","rimraf","iferr","uniq","Bluebird","npm","locker","lock","unlock","parseJSON","output","saveMetrics","save","copyTree","readShrinkwrap","computeMetadata","prefetchDeps","loadDeps","loadDevDeps","getAllMetadata","loadRequestedDeps","loadExtraneous","diffTrees","checkPermissions","decomposeActions","validateTree","validateArgs","saveRequested","saveShrinkwrap","audit","getPrintFundingReport","getPrintFundingReportJSON","getSaveType","doSerialActions","doSerial","doReverseSerialActions","doReverseSerial","doParallelActions","doParallel","doOneAction","doOne","removeObsoleteDep","removeExtraneous","computeVersionSpec","packageId","moduleName","errorMessage","isExtraneous","unlockCB","lockPath","name","installEr","args","reportErrorAndReturn","unlockEx","process","nextTick","unlockEr","code","warn","apply","where","globalTop","resolve","globalDir","config","get","prefix","dryrun","a","run","currentTree","idealTree","differences","todo","progress","noPackageJsonOk","topLevelLifecycles","autoPrune","dev","only","onlyProd","onlyDev","prod","packageLockOnly","rollback","link","saveOnlyLock","global","fund","started","Date","now","prototype","_cb","result","Promise","reject","value","prevGlobal","set","next","installSteps","postInstallSteps","push","newTracker","runPreinstallTopLevelLifecycles","loadCurrentTree","finishTracker","loadIdealTree","debugTree","generateActionsToTake","debugActions","startAudit","saveToDependencies","executeActions","node_modules","staging","rollbackFailedOptional","commit","runPostinstallTopLevelLifecycles","pruneIdealTree","debugLogicalTree","printWarnings","printInstalled","self","failing","postInstallEr","msg","summary","forEach","logline","detail","verbose","getInstalledModules","loadArgMetadata","cwd","tracker","size","newGroup","emit","silly","readGlobalPackageData","readLocalPackageData","normalizeCurrentTree","createNode","create","flatNameFromTree","isTop","normalizeTree","error","child","children","fakeChild","package","dependencies","tree","seen","Set","has","add","location","cloneCurrentTreeToIdealTree","loadShrinkwrap","loadAllDepsIntoIdealTree","hasRequiresFromLock","some","n","toPrune","removing","map","saveDeps","cg","installNewModules","steps","depsToPreload","Object","assign","devDependencies","andResolveDeps","computeLinked","linkTodoList","action","cmd","pkg","isReqByTop","requiredBy","mod","isReqByUser","userRequired","isLinkable","Array","globalPackage","globalPrefix","globalPackageJson","stat","er","readFile","data","json","noExceptions","version","trackLifecycle","actionsToRun","failed","top","asCallback","toCommit","done","runTopLevelLifecycles","auditSubmission","try","generateFromInstall","remove","then","auditData","submitForInstallReport","catch","_","pkgs","ctx","kid","parent","warnings","Error","errno","realpath","requires","missingDeps","missingDevDeps","andInflate","mutation","_id","warned","warning","levels","console","diffs","removedChildren","deps","r","d","timeout","auditResult","metadata","printInstalledForJSON","printInstalledForParseable","printInstalledForHuman","removed","added","updated","moved","contributors","people","meta","author","isArray","concat","person","normalized","normalizePerson","report","p","_requested","actions","packages","from","totalDependencies","lastAction","pop","num","argument","returned","email","url","printFundingReport","printInstallReport","funding","elapsed","message","flattenMessage","record","recordAction","JSON","stringify","isAlias","type","previousPath","fromPath","previousVersion","oldPkg","relative","actionListName","actionsToLog","treeName","archyDebugTree","trim","byName","aa","bb","localeCompare","expandTree","label","nodes","sort","unicode","archyDebugLogicalTree"],"sources":["/Users/hkateliev/node_modules/npm/lib/install.js"],"sourcesContent":["'use strict'\n/* eslint-disable camelcase */\n/* eslint-disable standard/no-callback-literal */\n// npm install <pkg> <pkg> <pkg>\n//\n// See doc/cli/npm-install.md for more description\n//\n// Managing contexts...\n// there's a lot of state associated with an \"install\" operation, including\n// packages that are already installed, parent packages, current shrinkwrap, and\n// so on. We maintain this state in a \"context\" object that gets passed around.\n// every time we dive into a deeper node_modules folder, the \"family\" list that\n// gets passed along uses the previous \"family\" list as its __proto__.  Any\n// \"resolved precise dependency\" things that aren't already on this object get\n// added, and then that's passed to the next generation of installation.\n\nmodule.exports = install\nmodule.exports.Installer = Installer\n\nvar usage = require('./utils/usage')\n\ninstall.usage = usage(\n  'install',\n  '\\nnpm install (with no args, in package dir)' +\n  '\\nnpm install [<@scope>/]<pkg>' +\n  '\\nnpm install [<@scope>/]<pkg>@<tag>' +\n  '\\nnpm install [<@scope>/]<pkg>@<version>' +\n  '\\nnpm install [<@scope>/]<pkg>@<version range>' +\n  '\\nnpm install <alias>@npm:<name>' +\n  '\\nnpm install <folder>' +\n  '\\nnpm install <tarball file>' +\n  '\\nnpm install <tarball url>' +\n  '\\nnpm install <git:// url>' +\n  '\\nnpm install <github username>/<github project>',\n  '[--save-prod|--save-dev|--save-optional] [--save-exact] [--no-save]'\n)\n\ninstall.completion = function (opts, cb) {\n  validate('OF', arguments)\n  // install can complete to a folder with a package.json, or any package.\n  // if it has a slash, then it's gotta be a folder\n  // if it starts with https?://, then just give up, because it's a url\n  if (/^https?:\\/\\//.test(opts.partialWord)) {\n    // do not complete to URLs\n    return cb(null, [])\n  }\n\n  if (/\\//.test(opts.partialWord)) {\n    // Complete fully to folder if there is exactly one match and it\n    // is a folder containing a package.json file.  If that is not the\n    // case we return 0 matches, which will trigger the default bash\n    // complete.\n    var lastSlashIdx = opts.partialWord.lastIndexOf('/')\n    var partialName = opts.partialWord.slice(lastSlashIdx + 1)\n    var partialPath = opts.partialWord.slice(0, lastSlashIdx)\n    if (partialPath === '') partialPath = '/'\n\n    var annotatePackageDirMatch = function (sibling, cb) {\n      var fullPath = path.join(partialPath, sibling)\n      if (sibling.slice(0, partialName.length) !== partialName) {\n        return cb(null, null) // not name match\n      }\n      fs.readdir(fullPath, function (err, contents) {\n        if (err) return cb(null, { isPackage: false })\n\n        cb(\n          null,\n          {\n            fullPath: fullPath,\n            isPackage: contents.indexOf('package.json') !== -1\n          }\n        )\n      })\n    }\n\n    return fs.readdir(partialPath, function (err, siblings) {\n      if (err) return cb(null, []) // invalid dir: no matching\n\n      asyncMap(siblings, annotatePackageDirMatch, function (err, matches) {\n        if (err) return cb(err)\n\n        var cleaned = matches.filter(function (x) { return x !== null })\n        if (cleaned.length !== 1) return cb(null, [])\n        if (!cleaned[0].isPackage) return cb(null, [])\n\n        // Success - only one match and it is a package dir\n        return cb(null, [cleaned[0].fullPath])\n      })\n    })\n  }\n\n  // FIXME: there used to be registry completion here, but it stopped making\n  // sense somewhere around 50,000 packages on the registry\n  cb()\n}\n\n// system packages\nvar fs = require('fs')\nvar path = require('path')\n\n// dependencies\nvar log = require('npmlog')\nvar readPackageTree = require('read-package-tree')\nvar readPackageJson = require('read-package-json')\nvar chain = require('slide').chain\nvar asyncMap = require('slide').asyncMap\nvar archy = require('archy')\nvar mkdirp = require('gentle-fs').mkdir\nvar rimraf = require('rimraf')\nvar iferr = require('iferr')\nvar validate = require('aproba')\nvar uniq = require('lodash.uniq')\nvar Bluebird = require('bluebird')\n\n// npm internal utils\nvar npm = require('./npm.js')\nvar locker = require('./utils/locker.js')\nvar lock = locker.lock\nvar unlock = locker.unlock\nvar parseJSON = require('./utils/parse-json.js')\nvar output = require('./utils/output.js')\nvar saveMetrics = require('./utils/metrics.js').save\n\n// install specific libraries\nvar copyTree = require('./install/copy-tree.js')\nvar readShrinkwrap = require('./install/read-shrinkwrap.js')\nvar computeMetadata = require('./install/deps.js').computeMetadata\nvar prefetchDeps = require('./install/deps.js').prefetchDeps\nvar loadDeps = require('./install/deps.js').loadDeps\nvar loadDevDeps = require('./install/deps.js').loadDevDeps\nvar getAllMetadata = require('./install/deps.js').getAllMetadata\nvar loadRequestedDeps = require('./install/deps.js').loadRequestedDeps\nvar loadExtraneous = require('./install/deps.js').loadExtraneous\nvar diffTrees = require('./install/diff-trees.js')\nvar checkPermissions = require('./install/check-permissions.js')\nvar decomposeActions = require('./install/decompose-actions.js')\nvar validateTree = require('./install/validate-tree.js')\nvar validateArgs = require('./install/validate-args.js')\nvar saveRequested = require('./install/save.js').saveRequested\nvar saveShrinkwrap = require('./install/save.js').saveShrinkwrap\nvar audit = require('./install/audit.js')\nvar {\n  getPrintFundingReport,\n  getPrintFundingReportJSON\n} = require('./install/fund.js')\nvar getSaveType = require('./install/save.js').getSaveType\nvar doSerialActions = require('./install/actions.js').doSerial\nvar doReverseSerialActions = require('./install/actions.js').doReverseSerial\nvar doParallelActions = require('./install/actions.js').doParallel\nvar doOneAction = require('./install/actions.js').doOne\nvar removeObsoleteDep = require('./install/deps.js').removeObsoleteDep\nvar removeExtraneous = require('./install/deps.js').removeExtraneous\nvar computeVersionSpec = require('./install/deps.js').computeVersionSpec\nvar packageId = require('./utils/package-id.js')\nvar moduleName = require('./utils/module-name.js')\nvar errorMessage = require('./utils/error-message.js')\nvar isExtraneous = require('./install/is-extraneous.js')\n\nfunction unlockCB (lockPath, name, cb) {\n  validate('SSF', arguments)\n  return function (installEr) {\n    var args = arguments\n    try {\n      unlock(lockPath, name, reportErrorAndReturn)\n    } catch (unlockEx) {\n      process.nextTick(function () {\n        reportErrorAndReturn(unlockEx)\n      })\n    }\n    function reportErrorAndReturn (unlockEr) {\n      if (installEr) {\n        if (unlockEr && unlockEr.code !== 'ENOTLOCKED') {\n          log.warn('unlock' + name, unlockEr)\n        }\n        return cb.apply(null, args)\n      }\n      if (unlockEr) return cb(unlockEr)\n      return cb.apply(null, args)\n    }\n  }\n}\n\nfunction install (where, args, cb) {\n  if (!cb) {\n    cb = args\n    args = where\n    where = null\n  }\n  var globalTop = path.resolve(npm.globalDir, '..')\n  if (!where) {\n    where = npm.config.get('global')\n      ? globalTop\n      : npm.prefix\n  }\n  validate('SAF', [where, args, cb])\n  // the /path/to/node_modules/..\n  var dryrun = !!npm.config.get('dry-run')\n\n  if (npm.config.get('dev')) {\n    log.warn('install', 'Usage of the `--dev` option is deprecated. Use `--also=dev` instead.')\n  }\n\n  if (where === globalTop && !args.length) {\n    args = ['.']\n  }\n  args = args.filter(function (a) {\n    return path.resolve(a) !== npm.prefix\n  })\n\n  new Installer(where, dryrun, args).run(cb)\n}\n\nfunction Installer (where, dryrun, args, opts) {\n  validate('SBA|SBAO', arguments)\n  if (!opts) opts = {}\n  this.where = where\n  this.dryrun = dryrun\n  this.args = args\n  // fakechildren are children created from the lockfile and lack relationship data\n  // the only exist when the tree does not match the lockfile\n  // this is fine when doing full tree installs/updates but not ok when modifying only\n  // a few deps via `npm install` or `npm uninstall`.\n  this.currentTree = null\n  this.idealTree = null\n  this.differences = []\n  this.todo = []\n  this.progress = {}\n  this.noPackageJsonOk = !!args.length\n  this.topLevelLifecycles = !args.length\n\n  this.autoPrune = npm.config.get('package-lock')\n\n  const dev = npm.config.get('dev')\n  const only = npm.config.get('only')\n  const onlyProd = /^prod(uction)?$/.test(only)\n  const onlyDev = /^dev(elopment)?$/.test(only)\n  const prod = npm.config.get('production')\n  this.dev = opts.dev != null ? opts.dev : dev || (!onlyProd && !prod) || onlyDev\n  this.prod = opts.prod != null ? opts.prod : !onlyDev\n\n  this.packageLockOnly = opts.packageLockOnly != null\n    ? opts.packageLockOnly : npm.config.get('package-lock-only')\n  this.rollback = opts.rollback != null ? opts.rollback : npm.config.get('rollback')\n  this.link = opts.link != null ? opts.link : npm.config.get('link')\n  this.saveOnlyLock = opts.saveOnlyLock\n  this.global = opts.global != null ? opts.global : this.where === path.resolve(npm.globalDir, '..')\n  this.audit = npm.config.get('audit') && !this.global\n  this.fund = npm.config.get('fund') && !this.global\n  this.started = Date.now()\n}\nInstaller.prototype = {}\n\nInstaller.prototype.run = function (_cb) {\n  validate('F|', arguments)\n\n  var result\n  var cb\n  if (_cb) {\n    cb = function (err) {\n      saveMetrics(!err)\n      return _cb.apply(this, arguments)\n    }\n  } else {\n    result = new Promise((resolve, reject) => {\n      cb = (err, value) => err ? reject(err) : resolve(value)\n    })\n  }\n  // FIXME: This is bad and I should feel bad.\n  // lib/install needs to have some way of sharing _limited_\n  // state with the things it calls. Passing the object is too\n  // much. The global config is WAY too much. =( =(\n  // But not having this is gonna break linked modules in\n  // subtle stupid ways, and refactoring all this code isn't\n  // the right thing to do just yet.\n  if (this.global) {\n    var prevGlobal = npm.config.get('global')\n    npm.config.set('global', true)\n    var next = cb\n    cb = function () {\n      npm.config.set('global', prevGlobal)\n      next.apply(null, arguments)\n    }\n  }\n\n  var installSteps = []\n  var postInstallSteps = []\n  if (!this.dryrun) {\n    installSteps.push(\n      [this.newTracker(log, 'runTopLevelLifecycles', 2)],\n      [this, this.runPreinstallTopLevelLifecycles])\n  }\n  installSteps.push(\n    [this.newTracker(log, 'loadCurrentTree', 4)],\n    [this, this.loadCurrentTree],\n    [this, this.finishTracker, 'loadCurrentTree'],\n\n    [this.newTracker(log, 'loadIdealTree', 12)],\n    [this, this.loadIdealTree],\n    [this, this.finishTracker, 'loadIdealTree'],\n\n    [this, this.debugTree, 'currentTree', 'currentTree'],\n    [this, this.debugTree, 'idealTree', 'idealTree'],\n\n    [this.newTracker(log, 'generateActionsToTake')],\n    [this, this.generateActionsToTake],\n    [this, this.finishTracker, 'generateActionsToTake'],\n\n    [this, this.debugActions, 'diffTrees', 'differences'],\n    [this, this.debugActions, 'decomposeActions', 'todo'],\n    [this, this.startAudit]\n  )\n\n  if (this.packageLockOnly) {\n    postInstallSteps.push(\n      [this, this.saveToDependencies])\n  } else if (!this.dryrun) {\n    installSteps.push(\n      [this.newTracker(log, 'executeActions', 8)],\n      [this, this.executeActions],\n      [this, this.finishTracker, 'executeActions'])\n    var node_modules = path.resolve(this.where, 'node_modules')\n    var staging = path.resolve(node_modules, '.staging')\n    postInstallSteps.push(\n      [this.newTracker(log, 'rollbackFailedOptional', 1)],\n      [this, this.rollbackFailedOptional, staging, this.todo],\n      [this, this.finishTracker, 'rollbackFailedOptional'],\n      [this, this.commit, staging, this.todo],\n\n      [this, this.runPostinstallTopLevelLifecycles],\n      [this, this.finishTracker, 'runTopLevelLifecycles']\n    )\n    if (getSaveType()) {\n      postInstallSteps.push(\n        // this is necessary as we don't fill in `dependencies` and `devDependencies` in deps loaded from shrinkwrap\n        // until after we extract them\n        [this, (next) => { computeMetadata(this.idealTree); next() }],\n        [this, this.pruneIdealTree],\n        [this, this.debugLogicalTree, 'saveTree', 'idealTree'],\n        [this, this.saveToDependencies])\n    }\n  }\n  postInstallSteps.push(\n    [this, this.printWarnings],\n    [this, this.printInstalled])\n\n  var self = this\n  chain(installSteps, function (installEr) {\n    if (installEr) self.failing = true\n    chain(postInstallSteps, function (postInstallEr) {\n      if (installEr && postInstallEr) {\n        var msg = errorMessage(postInstallEr)\n        msg.summary.forEach(function (logline) {\n          log.warn.apply(log, logline)\n        })\n        msg.detail.forEach(function (logline) {\n          log.verbose.apply(log, logline)\n        })\n      }\n      cb(installEr || postInstallEr, self.getInstalledModules(), self.idealTree)\n    })\n  })\n  return result\n}\n\nInstaller.prototype.loadArgMetadata = function (next) {\n  getAllMetadata(this.args, this.currentTree, process.cwd(), iferr(next, (args) => {\n    this.args = args\n    next()\n  }))\n}\n\nInstaller.prototype.newTracker = function (tracker, name, size) {\n  validate('OS', [tracker, name])\n  if (size) validate('N', [size])\n  this.progress[name] = tracker.newGroup(name, size)\n  return function (next) {\n    process.emit('time', 'stage:' + name)\n    next()\n  }\n}\n\nInstaller.prototype.finishTracker = function (name, cb) {\n  validate('SF', arguments)\n  process.emit('timeEnd', 'stage:' + name)\n  cb()\n}\n\nInstaller.prototype.loadCurrentTree = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'loadCurrentTree')\n  var todo = []\n  if (this.global) {\n    todo.push([this, this.readGlobalPackageData])\n  } else {\n    todo.push([this, this.readLocalPackageData])\n  }\n  todo.push([this, this.normalizeCurrentTree])\n  chain(todo, cb)\n}\n\nvar createNode = require('./install/node.js').create\nvar flatNameFromTree = require('./install/flatten-tree.js').flatNameFromTree\nInstaller.prototype.normalizeCurrentTree = function (cb) {\n  this.currentTree.isTop = true\n  normalizeTree(this.currentTree)\n  // If the user didn't have a package.json then fill in deps with what was on disk\n  if (this.currentTree.error) {\n    for (let child of this.currentTree.children) {\n      if (!child.fakeChild && isExtraneous(child)) {\n        this.currentTree.package.dependencies[moduleName(child)] = computeVersionSpec(this.currentTree, child)\n      }\n    }\n  }\n  computeMetadata(this.currentTree)\n  return cb()\n\n  function normalizeTree (tree, seen) {\n    if (!seen) seen = new Set()\n    if (seen.has(tree)) return\n    seen.add(tree)\n    createNode(tree)\n    tree.location = flatNameFromTree(tree)\n    tree.children.forEach((child) => normalizeTree(child, seen))\n  }\n}\n\nInstaller.prototype.loadIdealTree = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'loadIdealTree')\n\n  chain([\n    [this.newTracker(this.progress.loadIdealTree, 'loadIdealTree:cloneCurrentTree')],\n    [this, this.cloneCurrentTreeToIdealTree],\n    [this, this.finishTracker, 'loadIdealTree:cloneCurrentTree'],\n\n    [this.newTracker(this.progress.loadIdealTree, 'loadIdealTree:loadShrinkwrap')],\n    [this, this.loadShrinkwrap],\n    [this, this.finishTracker, 'loadIdealTree:loadShrinkwrap'],\n\n    [this.newTracker(this.progress.loadIdealTree, 'loadIdealTree:loadAllDepsIntoIdealTree', 10)],\n    [this, this.loadAllDepsIntoIdealTree],\n    [this, this.finishTracker, 'loadIdealTree:loadAllDepsIntoIdealTree'],\n    [this, function (next) { computeMetadata(this.idealTree); next() }],\n    [this, this.pruneIdealTree]\n  ], cb)\n}\n\nInstaller.prototype.pruneIdealTree = function (cb) {\n  if (!this.idealTree) return cb()\n  // if our lock file didn't have the requires field and there\n  // are any fake children then forgo pruning until we have more info.\n  if (!this.idealTree.hasRequiresFromLock && this.idealTree.children.some((n) => n.fakeChild)) return cb()\n  const toPrune = this.idealTree.children\n    .filter((child) => isExtraneous(child) && (this.autoPrune || child.removing))\n    .map((n) => ({name: moduleName(n)}))\n  return removeExtraneous(toPrune, this.idealTree, cb)\n}\n\nInstaller.prototype.loadAllDepsIntoIdealTree = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'loadAllDepsIntoIdealTree')\n  var saveDeps = getSaveType()\n\n  var cg = this.progress['loadIdealTree:loadAllDepsIntoIdealTree']\n  var installNewModules = !!this.args.length\n  var steps = []\n\n  if (installNewModules) {\n    steps.push([validateArgs, this.idealTree, this.args])\n    steps.push([loadRequestedDeps, this.args, this.idealTree, saveDeps, cg.newGroup('loadRequestedDeps')])\n  } else {\n    const depsToPreload = Object.assign({},\n      this.idealTree.package.devDependencies,\n      this.idealTree.package.dependencies\n    )\n    steps.push(\n      [prefetchDeps, this.idealTree, depsToPreload, cg.newGroup('prefetchDeps')],\n      [loadDeps, this.idealTree, cg.newGroup('loadDeps')],\n      [loadDevDeps, this.idealTree, cg.newGroup('loadDevDeps')])\n  }\n  steps.push(\n    [loadExtraneous.andResolveDeps, this.idealTree, cg.newGroup('loadExtraneous')])\n  chain(steps, cb)\n}\n\nInstaller.prototype.generateActionsToTake = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'generateActionsToTake')\n  var cg = this.progress.generateActionsToTake\n  chain([\n    [validateTree, this.idealTree, cg.newGroup('validateTree')],\n    [diffTrees, this.currentTree, this.idealTree, this.differences, cg.newGroup('diffTrees')],\n    [this, this.computeLinked],\n    [checkPermissions, this.differences],\n    [decomposeActions, this.differences, this.todo]\n  ], cb)\n}\n\nInstaller.prototype.computeLinked = function (cb) {\n  validate('F', arguments)\n  if (!this.link || this.global) return cb()\n  var linkTodoList = []\n  var self = this\n  asyncMap(this.differences, function (action, next) {\n    var cmd = action[0]\n    var pkg = action[1]\n    if (cmd !== 'add' && cmd !== 'update') return next()\n    var isReqByTop = pkg.requiredBy.filter(function (mod) { return mod.isTop }).length\n    var isReqByUser = pkg.userRequired\n    var isExtraneous = pkg.requiredBy.length === 0\n    if (!isReqByTop && !isReqByUser && !isExtraneous) return next()\n    isLinkable(pkg, function (install, link) {\n      if (install) linkTodoList.push(['global-install', pkg])\n      if (link) linkTodoList.push(['global-link', pkg])\n      if (install || link) removeObsoleteDep(pkg)\n      next()\n    })\n  }, function () {\n    if (linkTodoList.length === 0) return cb()\n    self.differences.length = 0\n    Array.prototype.push.apply(self.differences, linkTodoList)\n    diffTrees(self.currentTree, self.idealTree, self.differences, log.newGroup('d2'), cb)\n  })\n}\n\nfunction isLinkable (pkg, cb) {\n  var globalPackage = path.resolve(npm.globalPrefix, 'lib', 'node_modules', moduleName(pkg))\n  var globalPackageJson = path.resolve(globalPackage, 'package.json')\n  fs.stat(globalPackage, function (er) {\n    if (er) return cb(true, true)\n    fs.readFile(globalPackageJson, function (er, data) {\n      var json = parseJSON.noExceptions(data)\n      cb(false, json && json.version === pkg.package.version)\n    })\n  })\n}\n\nInstaller.prototype.executeActions = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'executeActions')\n  var todo = this.todo\n  var cg = this.progress.executeActions\n\n  var node_modules = path.resolve(this.where, 'node_modules')\n  var staging = path.resolve(node_modules, '.staging')\n  var steps = []\n  var trackLifecycle = cg.newGroup('lifecycle')\n\n  cb = unlockCB(node_modules, '.staging', cb)\n\n  steps.push(\n    [doSerialActions, 'global-install', staging, todo, trackLifecycle.newGroup('global-install')],\n    [lock, node_modules, '.staging'],\n    [rimraf, staging],\n    [doParallelActions, 'extract', staging, todo, cg.newGroup('extract', 100)],\n    [doReverseSerialActions, 'unbuild', staging, todo, cg.newGroup('unbuild')],\n    [doSerialActions, 'remove', staging, todo, cg.newGroup('remove')],\n    [doSerialActions, 'move', staging, todo, cg.newGroup('move')],\n    [doSerialActions, 'finalize', staging, todo, cg.newGroup('finalize')],\n    [doParallelActions, 'refresh-package-json', staging, todo, cg.newGroup('refresh-package-json')],\n    [doParallelActions, 'preinstall', staging, todo, trackLifecycle.newGroup('preinstall')],\n    [doSerialActions, 'build', staging, todo, trackLifecycle.newGroup('build')],\n    [doSerialActions, 'global-link', staging, todo, trackLifecycle.newGroup('global-link')],\n    [doParallelActions, 'update-linked', staging, todo, trackLifecycle.newGroup('update-linked')],\n    [doSerialActions, 'install', staging, todo, trackLifecycle.newGroup('install')],\n    [doSerialActions, 'postinstall', staging, todo, trackLifecycle.newGroup('postinstall')])\n\n  var self = this\n  chain(steps, function (er) {\n    if (!er || self.rollback) {\n      rimraf(staging, function () { cb(er) })\n    } else {\n      cb(er)\n    }\n  })\n}\n\nInstaller.prototype.rollbackFailedOptional = function (staging, actionsToRun, cb) {\n  if (!this.rollback) return cb()\n  var failed = uniq(actionsToRun.map(function (action) {\n    return action[1]\n  }).filter(function (pkg) {\n    return pkg.failed && pkg.rollback\n  }))\n  var top = this.currentTree && this.currentTree.path\n  Bluebird.map(failed, (pkg) => {\n    return Bluebird.map(pkg.rollback, (rollback) => rollback(top, staging, pkg))\n  }).asCallback(cb)\n}\n\nInstaller.prototype.commit = function (staging, actionsToRun, cb) {\n  var toCommit = actionsToRun.map(function (action) { return action[1] }).filter(function (pkg) { return !pkg.failed && pkg.commit })\n  asyncMap(toCommit, function (pkg, next) {\n    asyncMap(pkg.commit, function (commit, done) {\n      commit(staging, pkg, done)\n    }, function () {\n      pkg.commit = []\n      next.apply(null, arguments)\n    })\n  }, cb)\n}\n\nInstaller.prototype.runPreinstallTopLevelLifecycles = function (cb) {\n  validate('F', arguments)\n  if (this.failing) return cb()\n  if (!this.topLevelLifecycles) return cb()\n  log.silly('install', 'runPreinstallTopLevelLifecycles')\n\n  readPackageJson(path.join(this.where, 'package.json'), log, false, (err, data) => {\n    if (err) return cb()\n    this.currentTree = createNode({\n      isTop: true,\n      package: data,\n      path: this.where\n    })\n    doOneAction('preinstall', this.where, this.currentTree, log.newGroup('preinstall:.'), cb)\n  })\n}\n\nInstaller.prototype.runPostinstallTopLevelLifecycles = function (cb) {\n  validate('F', arguments)\n  if (this.failing) return cb()\n  if (!this.topLevelLifecycles) return cb()\n  log.silly('install', 'runPostinstallTopLevelLifecycles')\n  var steps = []\n  var trackLifecycle = this.progress.runTopLevelLifecycles\n\n  steps.push(\n    [doOneAction, 'build', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('build:.')],\n    [doOneAction, 'install', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('install:.')],\n    [doOneAction, 'postinstall', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('postinstall:.')])\n  if (this.dev) {\n    steps.push(\n      [doOneAction, 'prepare', this.idealTree.path, this.idealTree, trackLifecycle.newGroup('prepare')])\n  }\n  chain(steps, cb)\n}\n\nInstaller.prototype.startAudit = function (cb) {\n  if (!this.audit) return cb()\n  this.auditSubmission = Bluebird.try(() => {\n    return audit.generateFromInstall(this.idealTree, this.differences, this.args, this.remove)\n  }).then((auditData) => {\n    return audit.submitForInstallReport(auditData)\n  }).catch(_ => {})\n  cb()\n}\n\nInstaller.prototype.saveToDependencies = function (cb) {\n  validate('F', arguments)\n  if (this.failing) return cb()\n  log.silly('install', 'saveToDependencies')\n  // Note idealTree will be mutated during the save operations below as the\n  // package is reloaded from disk to preserve additional details. This means\n  // steps after postInstall will see a slightly different package object.\n  if (this.saveOnlyLock) {\n    saveShrinkwrap(this.idealTree, cb)\n  } else {\n    saveRequested(this.idealTree, cb)\n  }\n}\n\nInstaller.prototype.readGlobalPackageData = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'readGlobalPackageData')\n  var self = this\n  this.loadArgMetadata(iferr(cb, function () {\n    mkdirp(self.where, iferr(cb, function () {\n      var pkgs = {}\n      self.args.forEach(function (pkg) {\n        pkgs[pkg.name] = true\n      })\n      readPackageTree(self.where, function (ctx, kid) { return ctx.parent || pkgs[kid] }, iferr(cb, function (currentTree) {\n        self.currentTree = currentTree\n        return cb()\n      }))\n    }))\n  }))\n}\n\nInstaller.prototype.readLocalPackageData = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'readLocalPackageData')\n  var self = this\n  mkdirp(this.where, iferr(cb, function () {\n    readPackageTree(self.where, iferr(cb, function (currentTree) {\n      self.currentTree = currentTree\n      self.currentTree.warnings = []\n      if (currentTree.error && currentTree.error.code === 'EJSONPARSE') {\n        return cb(currentTree.error)\n      }\n      if (!self.noPackageJsonOk && !currentTree.package) {\n        log.error('install', \"Couldn't read dependencies\")\n        var er = new Error(\"ENOENT, open '\" + path.join(self.where, 'package.json') + \"'\")\n        er.code = 'ENOPACKAGEJSON'\n        er.errno = 34\n        return cb(er)\n      }\n      if (!currentTree.package) currentTree.package = {}\n      readShrinkwrap(currentTree, function (err) {\n        if (err) {\n          cb(err)\n        } else {\n          self.loadArgMetadata(cb)\n        }\n      })\n    }))\n  }))\n}\n\nInstaller.prototype.cloneCurrentTreeToIdealTree = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'cloneCurrentTreeToIdealTree')\n\n  if (npm.config.get('before')) {\n    this.idealTree = {\n      package: this.currentTree.package,\n      path: this.currentTree.path,\n      realpath: this.currentTree.realpath,\n      children: [],\n      requires: [],\n      missingDeps: {},\n      missingDevDeps: {},\n      requiredBy: [],\n      error: this.currentTree.error,\n      warnings: [],\n      isTop: true\n    }\n  } else {\n    this.idealTree = copyTree(this.currentTree)\n    this.idealTree.warnings = []\n  }\n\n  cb()\n}\n\nInstaller.prototype.loadShrinkwrap = function (cb) {\n  validate('F', arguments)\n  log.silly('install', 'loadShrinkwrap')\n  readShrinkwrap.andInflate(this.idealTree, iferr(cb, () => {\n    computeMetadata(this.idealTree)\n    cb()\n  }))\n}\n\nInstaller.prototype.getInstalledModules = function () {\n  return this.differences.filter(function (action) {\n    var mutation = action[0]\n    return (mutation === 'add' || mutation === 'update')\n  }).map(function (action) {\n    var child = action[1]\n    return [child.package._id, child.path]\n  })\n}\n\nInstaller.prototype.printWarnings = function (cb) {\n  if (!this.idealTree) return cb()\n\n  var self = this\n  var warned = false\n  this.idealTree.warnings.forEach(function (warning) {\n    if (warning.code === 'EPACKAGEJSON' && self.global) return\n    if (warning.code === 'ENOTDIR') return\n    warned = true\n    var msg = errorMessage(warning)\n    msg.summary.forEach(function (logline) {\n      log.warn.apply(log, logline)\n    })\n    msg.detail.forEach(function (logline) {\n      log.verbose.apply(log, logline)\n    })\n  })\n  if (warned && log.levels[npm.config.get('loglevel')] <= log.levels.warn) console.error()\n  cb()\n}\n\nInstaller.prototype.printInstalled = function (cb) {\n  validate('F', arguments)\n  if (this.failing) return cb()\n  log.silly('install', 'printInstalled')\n  const diffs = this.differences\n  if (!this.idealTree.error && this.idealTree.removedChildren) {\n    const deps = this.currentTree.package.dependencies || {}\n    const dev = this.currentTree.package.devDependencies || {}\n    this.idealTree.removedChildren.forEach((r) => {\n      if (diffs.some((d) => d[0] === 'remove' && d[1].path === r.path)) return\n      if (!deps[moduleName(r)] && !dev[moduleName(r)]) return\n      diffs.push(['remove', r])\n    })\n  }\n  return Bluebird.try(() => {\n    if (!this.auditSubmission) return\n    return Bluebird.resolve(this.auditSubmission).timeout(10000).catch(() => null)\n  }).then((auditResult) => {\n    if (auditResult && !auditResult.metadata) {\n      log.warn('audit', 'Audit result from registry missing metadata. This is probably an issue with the registry.')\n    }\n    // maybe write audit report w/ hash of pjson & shrinkwrap for later reading by `npm audit`\n    if (npm.config.get('json')) {\n      return this.printInstalledForJSON(diffs, auditResult)\n    } else if (npm.config.get('parseable')) {\n      return this.printInstalledForParseable(diffs, auditResult)\n    } else {\n      return this.printInstalledForHuman(diffs, auditResult)\n    }\n  }).asCallback(cb)\n}\n\nInstaller.prototype.printInstalledForHuman = function (diffs, auditResult) {\n  var removed = 0\n  var added = 0\n  var updated = 0\n  var moved = 0\n  // Count the number of contributors to packages added, tracking\n  // contributors we've seen, so we can produce a running unique count.\n  var contributors = new Set()\n  diffs.forEach(function (action) {\n    var mutation = action[0]\n    var pkg = action[1]\n    if (pkg.failed) return\n    if (mutation === 'remove') {\n      ++removed\n    } else if (mutation === 'move') {\n      ++moved\n    } else if (mutation === 'add') {\n      ++added\n      // Count contributors to added packages. Start by combining `author`\n      // and `contributors` data into a single array of contributor-people\n      // for this package.\n      var people = []\n      var meta = pkg.package\n      if (meta.author) people.push(meta.author)\n      if (meta.contributors && Array.isArray(meta.contributors)) {\n        people = people.concat(meta.contributors)\n      }\n      // Make sure a normalized string for every person behind this\n      // package is in `contributors`.\n      people.forEach(function (person) {\n        // Ignore errors from malformed `author` and `contributors`.\n        try {\n          var normalized = normalizePerson(person)\n        } catch (error) {\n          return\n        }\n        if (!contributors.has(normalized)) contributors.add(normalized)\n      })\n    } else if (mutation === 'update' || mutation === 'update-linked') {\n      ++updated\n    }\n  })\n  var report = ''\n  if (this.args.length && (added || updated)) {\n    report += this.args.map((p) => {\n      return `+ ${p.name}@${p.version}${\n        !p._requested.name || p._requested.name === p.name\n          ? ''\n          : ` (as ${p._requested.name})`\n      }`\n    }).join('\\n') + '\\n'\n  }\n  var actions = []\n  if (added) {\n    var action = 'added ' + packages(added)\n    if (contributors.size) action += from(contributors.size)\n    actions.push(action)\n  }\n  if (removed) actions.push('removed ' + packages(removed))\n  if (updated) actions.push('updated ' + packages(updated))\n  if (moved) actions.push('moved ' + packages(moved))\n  if (auditResult && auditResult.metadata && auditResult.metadata.totalDependencies) {\n    actions.push('audited ' + packages(auditResult.metadata.totalDependencies))\n  }\n  if (actions.length === 0) {\n    report += 'up to date'\n  } else if (actions.length === 1) {\n    report += actions[0]\n  } else {\n    var lastAction = actions.pop()\n    report += actions.join(', ') + ' and ' + lastAction\n  }\n  report += ' in ' + ((Date.now() - this.started) / 1000) + 's'\n\n  output(report)\n\n  function packages (num) {\n    return num + ' package' + (num > 1 ? 's' : '')\n  }\n\n  function from (num) {\n    return ' from ' + num + ' contributor' + (num > 1 ? 's' : '')\n  }\n\n  // Values of `author` and elements of `contributors` in `package.json`\n  // files can be e-mail style strings or Objects with `name`, `email,\n  // and `url` String properties.  Convert Objects to Strings so that\n  // we can efficiently keep a set of contributors we have already seen.\n  function normalizePerson (argument) {\n    if (typeof argument === 'string') return argument\n    var returned = ''\n    if (argument.name) returned += argument.name\n    if (argument.email) returned += ' <' + argument.email + '>'\n    if (argument.url) returned += ' (' + argument.email + ')'\n    return returned\n  }\n\n  const { fund, idealTree } = this\n  const printFundingReport = getPrintFundingReport({\n    fund,\n    idealTree\n  })\n  if (printFundingReport.length) {\n    output(printFundingReport)\n  }\n\n  if (auditResult) {\n    return audit.printInstallReport(auditResult)\n  }\n}\n\nInstaller.prototype.printInstalledForJSON = function (diffs, auditResult) {\n  const { fund, idealTree } = this\n  const printFundingReport = getPrintFundingReportJSON({\n    fund,\n    idealTree\n  })\n  var result = {\n    added: [],\n    removed: [],\n    updated: [],\n    moved: [],\n    failed: [],\n    warnings: [],\n    audit: auditResult,\n    funding: printFundingReport,\n    elapsed: Date.now() - this.started\n  }\n  var self = this\n  this.idealTree.warnings.forEach(function (warning) {\n    if (warning.code === 'EPACKAGEJSON' && self.global) return\n    if (warning.code === 'ENOTDIR') return\n    var output = errorMessage(warning)\n    var message = flattenMessage(output.summary)\n    if (output.detail.length) {\n      message += '\\n' + flattenMessage(output.detail)\n    }\n    result.warnings.push(message)\n  })\n  diffs.forEach(function (action) {\n    var mutation = action[0]\n    var child = action[1]\n    var record = recordAction(action)\n    if (child.failed) {\n      result.failed.push(record)\n    } else if (mutation === 'add') {\n      result.added.push(record)\n    } else if (mutation === 'update' || mutation === 'update-linked') {\n      result.updated.push(record)\n    } else if (mutation === 'move') {\n      result.moved.push(record)\n    } else if (mutation === 'remove') {\n      result.removed.push(record)\n    }\n  })\n  output(JSON.stringify(result, null, 2))\n\n  function flattenMessage (msg) {\n    return msg.map(function (logline) { return logline.slice(1).join(' ') }).join('\\n')\n  }\n\n  function recordAction (action) {\n    var mutation = action[0]\n    var child = action[1]\n    const isAlias = child.package && child.package._requested && child.package._requested.type === 'alias'\n    const name = isAlias\n      ? child.package._requested.name\n      : child.package && child.package.name\n    var result = {\n      action: mutation,\n      name,\n      version: child.package && `${isAlias ? `npm:${child.package.name}@` : ''}${child.package.version}`,\n      path: child.path\n    }\n    if (mutation === 'move') {\n      result.previousPath = child.fromPath\n    } else if (mutation === 'update') {\n      result.previousVersion = child.oldPkg.package && child.oldPkg.package.version\n    }\n    return result\n  }\n}\n\nInstaller.prototype.printInstalledForParseable = function (diffs) {\n  var self = this\n  diffs.forEach(function (action) {\n    var mutation = action[0]\n    var child = action[1]\n    if (mutation === 'move') {\n      var previousPath = path.relative(self.where, child.fromPath)\n    } else if (mutation === 'update') {\n      var previousVersion = child.oldPkg.package && child.oldPkg.package.version\n    }\n    const isAlias = child.package._requested && child.package._requested.type === 'alias'\n    const version = child.package && isAlias\n      ? `npm:${child.package.name}@${child.package.version}`\n      : child.package\n        ? child.package.version\n        : ''\n    output(\n      mutation + '\\t' +\n      moduleName(child) + '\\t' +\n      version + '\\t' +\n      (child.path ? path.relative(self.where, child.path) : '') + '\\t' +\n      (previousVersion || '') + '\\t' +\n      (previousPath || ''))\n  })\n}\n\nInstaller.prototype.debugActions = function (name, actionListName, cb) {\n  validate('SSF', arguments)\n  var actionsToLog = this[actionListName]\n  log.silly(name, 'action count', actionsToLog.length)\n  actionsToLog.forEach(function (action) {\n    log.silly(name, action.map(function (value) {\n      return (value && value.package) ? packageId(value) : value\n    }).join(' '))\n  })\n  cb()\n}\n\n// This takes an object and a property name instead of a value to allow us\n// to define the arguments for use by chain before the property exists yet.\nInstaller.prototype.debugTree = function (name, treeName, cb) {\n  validate('SSF', arguments)\n  log.silly(name, this.archyDebugTree(this[treeName]).trim())\n  cb()\n}\n\nInstaller.prototype.archyDebugTree = function (tree) {\n  validate('O', arguments)\n  var seen = new Set()\n  function byName (aa, bb) {\n    return packageId(aa).localeCompare(packageId(bb))\n  }\n  function expandTree (tree) {\n    seen.add(tree)\n    return {\n      label: packageId(tree),\n      nodes: tree.children.filter((tree) => { return !seen.has(tree) && !tree.removed }).sort(byName).map(expandTree)\n    }\n  }\n  return archy(expandTree(tree), '', { unicode: npm.config.get('unicode') })\n}\n\nInstaller.prototype.debugLogicalTree = function (name, treeName, cb) {\n  validate('SSF', arguments)\n  this[treeName] && log.silly(name, this.archyDebugLogicalTree(this[treeName]).trim())\n  cb()\n}\n\nInstaller.prototype.archyDebugLogicalTree = function (tree) {\n  validate('O', arguments)\n  var seen = new Set()\n  function byName (aa, bb) {\n    return packageId(aa).localeCompare(packageId(bb))\n  }\n  function expandTree (tree) {\n    seen.add(tree)\n    return {\n      label: packageId(tree),\n      nodes: tree.requires.filter((tree) => { return !seen.has(tree) && !tree.removed }).sort(byName).map(expandTree)\n    }\n  }\n  return archy(expandTree(tree), '', { unicode: npm.config.get('unicode') })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}