{"ast":null,"code":"var fs = require('fs');\nvar path = require('path');\nvar util = require('util');\nvar semver = require('semver');\nexports.checkEngine = checkEngine;\nfunction checkEngine(target, npmVer, nodeVer, force, strict, cb) {\n  var nodev = force ? null : nodeVer;\n  var eng = target.engines;\n  var opt = {\n    includePrerelease: true\n  };\n  if (!eng) return cb();\n  if (nodev && eng.node && !semver.satisfies(nodev, eng.node, opt) || eng.npm && !semver.satisfies(npmVer, eng.npm, opt)) {\n    var er = new Error(util.format('Unsupported engine for %s: wanted: %j (current: %j)', target._id, eng, {\n      node: nodev,\n      npm: npmVer\n    }));\n    er.code = 'ENOTSUP';\n    er.required = eng;\n    er.pkgid = target._id;\n    if (strict) {\n      return cb(er);\n    } else {\n      return cb(null, er);\n    }\n  }\n  return cb();\n}\nexports.checkPlatform = checkPlatform;\nfunction checkPlatform(target, force, cb) {\n  var platform = process.platform;\n  var arch = process.arch;\n  var osOk = true;\n  var cpuOk = true;\n  if (force) {\n    return cb();\n  }\n  if (target.os) {\n    osOk = checkList(platform, target.os);\n  }\n  if (target.cpu) {\n    cpuOk = checkList(arch, target.cpu);\n  }\n  if (!osOk || !cpuOk) {\n    var er = new Error(util.format('Unsupported platform for %s: wanted %j (current: %j)', target._id, target, {\n      os: platform,\n      cpu: arch\n    }));\n    er.code = 'EBADPLATFORM';\n    er.os = target.os || ['any'];\n    er.cpu = target.cpu || ['any'];\n    er.pkgid = target._id;\n    return cb(er);\n  }\n  return cb();\n}\nfunction checkList(value, list) {\n  var tmp;\n  var match = false;\n  var blc = 0;\n  if (typeof list === 'string') {\n    list = [list];\n  }\n  if (list.length === 1 && list[0] === 'any') {\n    return true;\n  }\n  for (var i = 0; i < list.length; ++i) {\n    tmp = list[i];\n    if (tmp[0] === '!') {\n      tmp = tmp.slice(1);\n      if (tmp === value) {\n        return false;\n      }\n      ++blc;\n    } else {\n      match = match || tmp === value;\n    }\n  }\n  return match || blc === list.length;\n}\nexports.checkCycle = checkCycle;\nfunction checkCycle(target, ancestors, cb) {\n  // there are some very rare and pathological edge-cases where\n  // a cycle can cause npm to try to install a never-ending tree\n  // of stuff.\n  // Simplest:\n  //\n  // A -> B -> A' -> B' -> A -> B -> A' -> B' -> A -> ...\n  //\n  // Solution: Simply flat-out refuse to install any name@version\n  // that is already in the prototype tree of the ancestors object.\n  // A more correct, but more complex, solution would be to symlink\n  // the deeper thing into the new location.\n  // Will do that if anyone whines about this irl.\n  //\n  // Note: `npm install foo` inside of the `foo` package will abort\n  // earlier if `--force` is not set.  However, if it IS set, then\n  // we need to still fail here, but just skip the first level. Of\n  // course, it'll still fail eventually if it's a true cycle, and\n  // leave things in an undefined state, but that's what is to be\n  // expected when `--force` is used.  That is why getPrototypeOf\n  // is used *twice* here: to skip the first level of repetition.\n\n  var p = Object.getPrototypeOf(Object.getPrototypeOf(ancestors));\n  var name = target.name;\n  var version = target.version;\n  while (p && p !== Object.prototype && p[name] !== version) {\n    p = Object.getPrototypeOf(p);\n  }\n  if (p[name] !== version) return cb();\n  var er = new Error(target._id + ': Unresolvable cycle detected');\n  var tree = [target._id, JSON.parse(JSON.stringify(ancestors))];\n  var t = Object.getPrototypeOf(ancestors);\n  while (t && t !== Object.prototype) {\n    if (t === p) t.THIS_IS_P = true;\n    tree.push(JSON.parse(JSON.stringify(t)));\n    t = Object.getPrototypeOf(t);\n  }\n  er.pkgid = target._id;\n  er.code = 'ECYCLE';\n  return cb(er);\n}\nexports.checkGit = checkGit;\nfunction checkGit(folder, cb) {\n  // if it's a git repo then don't touch it!\n  fs.lstat(folder, function (er, s) {\n    if (er || !s.isDirectory()) return cb();else checkGit_(folder, cb);\n  });\n}\nfunction checkGit_(folder, cb) {\n  fs.stat(path.resolve(folder, '.git'), function (er, s) {\n    if (!er && s.isDirectory()) {\n      var e = new Error(folder + ': Appears to be a git repo or submodule.');\n      e.path = folder;\n      e.code = 'EISGIT';\n      return cb(e);\n    }\n    cb();\n  });\n}","map":{"version":3,"names":["fs","require","path","util","semver","exports","checkEngine","target","npmVer","nodeVer","force","strict","cb","nodev","eng","engines","opt","includePrerelease","node","satisfies","npm","er","Error","format","_id","code","required","pkgid","checkPlatform","platform","process","arch","osOk","cpuOk","os","checkList","cpu","value","list","tmp","match","blc","length","i","slice","checkCycle","ancestors","p","Object","getPrototypeOf","name","version","prototype","tree","JSON","parse","stringify","t","THIS_IS_P","push","checkGit","folder","lstat","s","isDirectory","checkGit_","stat","resolve","e"],"sources":["/Users/hkateliev/node_modules/npm/node_modules/npm-install-checks/index.js"],"sourcesContent":["var fs = require('fs')\nvar path = require('path')\nvar util = require('util')\nvar semver = require('semver')\n\nexports.checkEngine = checkEngine\nfunction checkEngine (target, npmVer, nodeVer, force, strict, cb) {\n  var nodev = force ? null : nodeVer\n  var eng = target.engines\n  var opt = { includePrerelease: true }\n  if (!eng) return cb()\n  if (nodev && eng.node && !semver.satisfies(nodev, eng.node, opt) ||\n      eng.npm && !semver.satisfies(npmVer, eng.npm, opt)) {\n    var er = new Error(util.format('Unsupported engine for %s: wanted: %j (current: %j)',\n      target._id, eng, {node: nodev, npm: npmVer}))\n    er.code = 'ENOTSUP'\n    er.required = eng\n    er.pkgid = target._id\n    if (strict) {\n      return cb(er)\n    } else {\n      return cb(null, er)\n    }\n  }\n  return cb()\n}\n\nexports.checkPlatform = checkPlatform\nfunction checkPlatform (target, force, cb) {\n  var platform = process.platform\n  var arch = process.arch\n  var osOk = true\n  var cpuOk = true\n\n  if (force) {\n    return cb()\n  }\n\n  if (target.os) {\n    osOk = checkList(platform, target.os)\n  }\n  if (target.cpu) {\n    cpuOk = checkList(arch, target.cpu)\n  }\n  if (!osOk || !cpuOk) {\n    var er = new Error(util.format('Unsupported platform for %s: wanted %j (current: %j)',\n      target._id, target, {os: platform, cpu: arch}))\n    er.code = 'EBADPLATFORM'\n    er.os = target.os || ['any']\n    er.cpu = target.cpu || ['any']\n    er.pkgid = target._id\n    return cb(er)\n  }\n  return cb()\n}\n\nfunction checkList (value, list) {\n  var tmp\n  var match = false\n  var blc = 0\n  if (typeof list === 'string') {\n    list = [list]\n  }\n  if (list.length === 1 && list[0] === 'any') {\n    return true\n  }\n  for (var i = 0; i < list.length; ++i) {\n    tmp = list[i]\n    if (tmp[0] === '!') {\n      tmp = tmp.slice(1)\n      if (tmp === value) {\n        return false\n      }\n      ++blc\n    } else {\n      match = match || tmp === value\n    }\n  }\n  return match || blc === list.length\n}\n\nexports.checkCycle = checkCycle\nfunction checkCycle (target, ancestors, cb) {\n  // there are some very rare and pathological edge-cases where\n  // a cycle can cause npm to try to install a never-ending tree\n  // of stuff.\n  // Simplest:\n  //\n  // A -> B -> A' -> B' -> A -> B -> A' -> B' -> A -> ...\n  //\n  // Solution: Simply flat-out refuse to install any name@version\n  // that is already in the prototype tree of the ancestors object.\n  // A more correct, but more complex, solution would be to symlink\n  // the deeper thing into the new location.\n  // Will do that if anyone whines about this irl.\n  //\n  // Note: `npm install foo` inside of the `foo` package will abort\n  // earlier if `--force` is not set.  However, if it IS set, then\n  // we need to still fail here, but just skip the first level. Of\n  // course, it'll still fail eventually if it's a true cycle, and\n  // leave things in an undefined state, but that's what is to be\n  // expected when `--force` is used.  That is why getPrototypeOf\n  // is used *twice* here: to skip the first level of repetition.\n\n  var p = Object.getPrototypeOf(Object.getPrototypeOf(ancestors))\n  var name = target.name\n  var version = target.version\n  while (p && p !== Object.prototype && p[name] !== version) {\n    p = Object.getPrototypeOf(p)\n  }\n  if (p[name] !== version) return cb()\n\n  var er = new Error(target._id + ': Unresolvable cycle detected')\n  var tree = [target._id, JSON.parse(JSON.stringify(ancestors))]\n  var t = Object.getPrototypeOf(ancestors)\n  while (t && t !== Object.prototype) {\n    if (t === p) t.THIS_IS_P = true\n    tree.push(JSON.parse(JSON.stringify(t)))\n    t = Object.getPrototypeOf(t)\n  }\n  er.pkgid = target._id\n  er.code = 'ECYCLE'\n  return cb(er)\n}\n\nexports.checkGit = checkGit\nfunction checkGit (folder, cb) {\n  // if it's a git repo then don't touch it!\n  fs.lstat(folder, function (er, s) {\n    if (er || !s.isDirectory()) return cb()\n    else checkGit_(folder, cb)\n  })\n}\n\nfunction checkGit_ (folder, cb) {\n  fs.stat(path.resolve(folder, '.git'), function (er, s) {\n    if (!er && s.isDirectory()) {\n      var e = new Error(folder + ': Appears to be a git repo or submodule.')\n      e.path = folder\n      e.code = 'EISGIT'\n      return cb(e)\n    }\n    cb()\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}