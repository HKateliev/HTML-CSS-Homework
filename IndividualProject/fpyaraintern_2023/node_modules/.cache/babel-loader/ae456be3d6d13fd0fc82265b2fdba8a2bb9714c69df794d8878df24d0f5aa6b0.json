{"ast":null,"code":"'use strict';\n\nconst BB = require('bluebird');\nconst cacache = require('cacache');\nconst finished = BB.promisify(require('mississippi').finished);\nconst optCheck = require('./lib/util/opt-check');\nconst npa = require('npm-package-arg');\nmodule.exports = prefetch;\nfunction prefetch(spec, opts) {\n  opts = optCheck(opts);\n  spec = npa(spec, opts.where);\n  opts.log.warn('prefetch', 'pacote.prefetch() is deprecated. Please use pacote.tarball() instead.');\n  const startTime = Date.now();\n  if (!opts.cache) {\n    opts.log.info('prefetch', 'skipping prefetch: no cache provided');\n    return BB.resolve({\n      spec\n    });\n  }\n  if (opts.integrity && !opts.preferOnline) {\n    opts.log.silly('prefetch', 'checking if', opts.integrity, 'is already cached');\n    return cacache.get.hasContent(opts.cache, opts.integrity).then(info => {\n      if (info) {\n        opts.log.silly('prefetch', `content already exists for ${spec} (${Date.now() - startTime}ms)`);\n        return {\n          spec,\n          integrity: info.integrity,\n          size: info.size,\n          byDigest: true\n        };\n      } else {\n        return prefetchByManifest(startTime, spec, opts);\n      }\n    });\n  } else {\n    opts.log.silly('prefetch', `no integrity hash provided for ${spec} - fetching by manifest`);\n    return prefetchByManifest(startTime, spec, opts);\n  }\n}\nlet fetch;\nfunction prefetchByManifest(start, spec, opts) {\n  let manifest;\n  let integrity;\n  return BB.resolve().then(() => {\n    if (!fetch) {\n      fetch = require('./lib/fetch');\n    }\n    const stream = fetch.tarball(spec, opts);\n    if (!stream) {\n      return;\n    }\n    stream.on('data', function () {});\n    stream.on('manifest', m => {\n      manifest = m;\n    });\n    stream.on('integrity', i => {\n      integrity = i;\n    });\n    return finished(stream);\n  }).then(() => {\n    opts.log.silly('prefetch', `${spec} done in ${Date.now() - start}ms`);\n    return {\n      manifest,\n      spec,\n      integrity: integrity || manifest && manifest._integrity,\n      byDigest: false\n    };\n  });\n}","map":{"version":3,"names":["BB","require","cacache","finished","promisify","optCheck","npa","module","exports","prefetch","spec","opts","where","log","warn","startTime","Date","now","cache","info","resolve","integrity","preferOnline","silly","get","hasContent","then","size","byDigest","prefetchByManifest","fetch","start","manifest","stream","tarball","on","m","i","_integrity"],"sources":["/Users/hkateliev/node_modules/npm/node_modules/pacote/prefetch.js"],"sourcesContent":["'use strict'\n\nconst BB = require('bluebird')\n\nconst cacache = require('cacache')\nconst finished = BB.promisify(require('mississippi').finished)\nconst optCheck = require('./lib/util/opt-check')\nconst npa = require('npm-package-arg')\n\nmodule.exports = prefetch\nfunction prefetch (spec, opts) {\n  opts = optCheck(opts)\n  spec = npa(spec, opts.where)\n  opts.log.warn('prefetch', 'pacote.prefetch() is deprecated. Please use pacote.tarball() instead.')\n  const startTime = Date.now()\n  if (!opts.cache) {\n    opts.log.info('prefetch', 'skipping prefetch: no cache provided')\n    return BB.resolve({ spec })\n  }\n  if (opts.integrity && !opts.preferOnline) {\n    opts.log.silly('prefetch', 'checking if', opts.integrity, 'is already cached')\n    return cacache.get.hasContent(opts.cache, opts.integrity).then(info => {\n      if (info) {\n        opts.log.silly('prefetch', `content already exists for ${spec} (${Date.now() - startTime}ms)`)\n        return {\n          spec,\n          integrity: info.integrity,\n          size: info.size,\n          byDigest: true\n        }\n      } else {\n        return prefetchByManifest(startTime, spec, opts)\n      }\n    })\n  } else {\n    opts.log.silly('prefetch', `no integrity hash provided for ${spec} - fetching by manifest`)\n    return prefetchByManifest(startTime, spec, opts)\n  }\n}\n\nlet fetch\nfunction prefetchByManifest (start, spec, opts) {\n  let manifest\n  let integrity\n  return BB.resolve().then(() => {\n    if (!fetch) {\n      fetch = require('./lib/fetch')\n    }\n    const stream = fetch.tarball(spec, opts)\n    if (!stream) { return }\n    stream.on('data', function () {})\n    stream.on('manifest', m => { manifest = m })\n    stream.on('integrity', i => { integrity = i })\n    return finished(stream)\n  }).then(() => {\n    opts.log.silly('prefetch', `${spec} done in ${Date.now() - start}ms`)\n    return {\n      manifest,\n      spec,\n      integrity: integrity || (manifest && manifest._integrity),\n      byDigest: false\n    }\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}