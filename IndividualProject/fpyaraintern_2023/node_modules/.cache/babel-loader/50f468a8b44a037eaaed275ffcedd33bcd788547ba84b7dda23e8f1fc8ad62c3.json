{"ast":null,"code":"'use strict';\n\nconst figgyPudding = require('figgy-pudding');\nconst npa = require('npm-package-arg');\nconst semver = require('semver');\nconst PickerOpts = figgyPudding({\n  defaultTag: {\n    default: 'latest'\n  },\n  enjoyBy: {},\n  includeDeprecated: {\n    default: false\n  }\n});\nmodule.exports = pickManifest;\nfunction pickManifest(packument, wanted, opts) {\n  opts = PickerOpts(opts);\n  const time = opts.enjoyBy && packument.time && +new Date(opts.enjoyBy);\n  const spec = npa.resolve(packument.name, wanted);\n  const type = spec.type;\n  if (type === 'version' || type === 'range') {\n    wanted = semver.clean(wanted, true) || wanted;\n  }\n  const distTags = packument['dist-tags'] || {};\n  const versions = Object.keys(packument.versions || {}).filter(v => {\n    return semver.valid(v, true);\n  });\n  const policyRestrictions = packument.policyRestrictions;\n  const restrictedVersions = policyRestrictions ? Object.keys(policyRestrictions.versions) : [];\n  function enjoyableBy(v) {\n    return !time || packument.time[v] && time >= +new Date(packument.time[v]);\n  }\n  let err;\n  if (!versions.length && !restrictedVersions.length) {\n    err = new Error(`No valid versions available for ${packument.name}`);\n    err.code = 'ENOVERSIONS';\n    err.name = packument.name;\n    err.type = type;\n    err.wanted = wanted;\n    throw err;\n  }\n  let target;\n  if (type === 'tag' && enjoyableBy(distTags[wanted])) {\n    target = distTags[wanted];\n  } else if (type === 'version') {\n    target = wanted;\n  } else if (type !== 'range' && enjoyableBy(distTags[wanted])) {\n    throw new Error('Only tag, version, and range are supported');\n  }\n  const tagVersion = distTags[opts.defaultTag];\n  if (!target && tagVersion && packument.versions[tagVersion] && enjoyableBy(tagVersion) && semver.satisfies(tagVersion, wanted, true)) {\n    target = tagVersion;\n  }\n  if (!target && !opts.includeDeprecated) {\n    const undeprecated = versions.filter(v => !packument.versions[v].deprecated && enjoyableBy(v));\n    target = semver.maxSatisfying(undeprecated, wanted, true);\n  }\n  if (!target) {\n    const stillFresh = versions.filter(enjoyableBy);\n    target = semver.maxSatisfying(stillFresh, wanted, true);\n  }\n  if (!target && wanted === '*' && enjoyableBy(tagVersion)) {\n    // This specific corner is meant for the case where\n    // someone is using `*` as a selector, but all versions\n    // are pre-releases, which don't match ranges at all.\n    target = tagVersion;\n  }\n  if (!target && time && type === 'tag' && distTags[wanted] && !enjoyableBy(distTags[wanted])) {\n    const stillFresh = versions.filter(v => enjoyableBy(v) && semver.lte(v, distTags[wanted], true)).sort(semver.rcompare);\n    target = stillFresh[0];\n  }\n  if (!target && restrictedVersions) {\n    target = semver.maxSatisfying(restrictedVersions, wanted, true);\n  }\n  const manifest = target && packument.versions[target];\n  if (!manifest) {\n    // Check if target is forbidden\n    const isForbidden = target && policyRestrictions && policyRestrictions.versions[target];\n    const pckg = `${packument.name}@${wanted}${opts.enjoyBy ? ` with an Enjoy By date of ${new Date(opts.enjoyBy).toLocaleString()}. Maybe try a different date?` : ''}`;\n    if (isForbidden) {\n      err = new Error(`Could not download ${pckg} due to policy violations.\\n${policyRestrictions.message}\\n`);\n      err.code = 'E403';\n    } else {\n      err = new Error(`No matching version found for ${pckg}.`);\n      err.code = 'ETARGET';\n    }\n    err.name = packument.name;\n    err.type = type;\n    err.wanted = wanted;\n    err.versions = versions;\n    err.distTags = distTags;\n    err.defaultTag = opts.defaultTag;\n    throw err;\n  } else {\n    return manifest;\n  }\n}","map":{"version":3,"names":["figgyPudding","require","npa","semver","PickerOpts","defaultTag","default","enjoyBy","includeDeprecated","module","exports","pickManifest","packument","wanted","opts","time","Date","spec","resolve","name","type","clean","distTags","versions","Object","keys","filter","v","valid","policyRestrictions","restrictedVersions","enjoyableBy","err","length","Error","code","target","tagVersion","satisfies","undeprecated","deprecated","maxSatisfying","stillFresh","lte","sort","rcompare","manifest","isForbidden","pckg","toLocaleString","message"],"sources":["/Users/hkateliev/node_modules/npm/node_modules/npm-pick-manifest/index.js"],"sourcesContent":["'use strict'\n\nconst figgyPudding = require('figgy-pudding')\nconst npa = require('npm-package-arg')\nconst semver = require('semver')\n\nconst PickerOpts = figgyPudding({\n  defaultTag: { default: 'latest' },\n  enjoyBy: {},\n  includeDeprecated: { default: false }\n})\n\nmodule.exports = pickManifest\nfunction pickManifest (packument, wanted, opts) {\n  opts = PickerOpts(opts)\n  const time = opts.enjoyBy && packument.time && +(new Date(opts.enjoyBy))\n  const spec = npa.resolve(packument.name, wanted)\n  const type = spec.type\n  if (type === 'version' || type === 'range') {\n    wanted = semver.clean(wanted, true) || wanted\n  }\n  const distTags = packument['dist-tags'] || {}\n  const versions = Object.keys(packument.versions || {}).filter(v => {\n    return semver.valid(v, true)\n  })\n  const policyRestrictions = packument.policyRestrictions\n  const restrictedVersions = policyRestrictions\n    ? Object.keys(policyRestrictions.versions) : []\n\n  function enjoyableBy (v) {\n    return !time || (\n      packument.time[v] && time >= +(new Date(packument.time[v]))\n    )\n  }\n\n  let err\n\n  if (!versions.length && !restrictedVersions.length) {\n    err = new Error(`No valid versions available for ${packument.name}`)\n    err.code = 'ENOVERSIONS'\n    err.name = packument.name\n    err.type = type\n    err.wanted = wanted\n    throw err\n  }\n\n  let target\n\n  if (type === 'tag' && enjoyableBy(distTags[wanted])) {\n    target = distTags[wanted]\n  } else if (type === 'version') {\n    target = wanted\n  } else if (type !== 'range' && enjoyableBy(distTags[wanted])) {\n    throw new Error('Only tag, version, and range are supported')\n  }\n\n  const tagVersion = distTags[opts.defaultTag]\n\n  if (\n    !target &&\n    tagVersion &&\n    packument.versions[tagVersion] &&\n    enjoyableBy(tagVersion) &&\n    semver.satisfies(tagVersion, wanted, true)\n  ) {\n    target = tagVersion\n  }\n\n  if (!target && !opts.includeDeprecated) {\n    const undeprecated = versions.filter(v => !packument.versions[v].deprecated && enjoyableBy(v)\n    )\n    target = semver.maxSatisfying(undeprecated, wanted, true)\n  }\n  if (!target) {\n    const stillFresh = versions.filter(enjoyableBy)\n    target = semver.maxSatisfying(stillFresh, wanted, true)\n  }\n\n  if (!target && wanted === '*' && enjoyableBy(tagVersion)) {\n    // This specific corner is meant for the case where\n    // someone is using `*` as a selector, but all versions\n    // are pre-releases, which don't match ranges at all.\n    target = tagVersion\n  }\n\n  if (\n    !target &&\n    time &&\n    type === 'tag' &&\n    distTags[wanted] &&\n    !enjoyableBy(distTags[wanted])\n  ) {\n    const stillFresh = versions.filter(v =>\n      enjoyableBy(v) && semver.lte(v, distTags[wanted], true)\n    ).sort(semver.rcompare)\n    target = stillFresh[0]\n  }\n\n  if (!target && restrictedVersions) {\n    target = semver.maxSatisfying(restrictedVersions, wanted, true)\n  }\n\n  const manifest = (\n    target &&\n    packument.versions[target]\n  )\n  if (!manifest) {\n    // Check if target is forbidden\n    const isForbidden = target && policyRestrictions && policyRestrictions.versions[target]\n    const pckg = `${packument.name}@${wanted}${\n      opts.enjoyBy\n        ? ` with an Enjoy By date of ${\n          new Date(opts.enjoyBy).toLocaleString()\n        }. Maybe try a different date?`\n        : ''\n    }`\n\n    if (isForbidden) {\n      err = new Error(`Could not download ${pckg} due to policy violations.\\n${policyRestrictions.message}\\n`)\n      err.code = 'E403'\n    } else {\n      err = new Error(`No matching version found for ${pckg}.`)\n      err.code = 'ETARGET'\n    }\n\n    err.name = packument.name\n    err.type = type\n    err.wanted = wanted\n    err.versions = versions\n    err.distTags = distTags\n    err.defaultTag = opts.defaultTag\n    throw err\n  } else {\n    return manifest\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}