{"ast":null,"code":"var fs = require('graceful-fs');\nvar dz = require('dezalgo');\nvar once = require('once');\nvar path = require('path');\nvar debug = require('debuglog')('rds');\nmodule.exports = readdir;\nreaddir.sync = readdirSync;\nfunction readdir(dir, cb) {\n  fs.readdir(dir, function (er, kids) {\n    if (er) return cb(er);\n    debug('dir=%j, kids=%j', dir, kids);\n    readScopes(dir, kids, function (er, data) {\n      if (er) return cb(er);\n\n      // Sort for bonus consistency points\n      data = data.sort(function (a, b) {\n        return a > b ? 1 : -1;\n      });\n      return cb(null, data);\n    });\n  });\n}\nfunction readdirSync(dir) {\n  var kids = fs.readdirSync(dir);\n  debug('dir=%j, kids=%j', dir, kids);\n  var data = readScopesSync(dir, kids);\n  // Sort for bonus consistency points\n  data = data.sort(function (a, b) {\n    return a > b ? 1 : -1;\n  });\n  return data;\n}\n\n// Turn [ 'a', '@scope' ] into\n// ['a', '@scope/foo', '@scope/bar']\nfunction readScopes(root, kids, cb) {\n  var scopes = kids.filter(function (kid) {\n    return kid.charAt(0) === '@';\n  });\n  kids = kids.filter(function (kid) {\n    return kid.charAt(0) !== '@';\n  });\n  debug('scopes=%j', scopes);\n  if (scopes.length === 0) dz(cb)(null, kids); // prevent maybe-sync zalgo release\n\n  cb = once(cb);\n  var l = scopes.length;\n  scopes.forEach(function (scope) {\n    var scopedir = path.resolve(root, scope);\n    debug('root=%j scope=%j scopedir=%j', root, scope, scopedir);\n    fs.readdir(scopedir, then.bind(null, scope));\n  });\n  function then(scope, er, scopekids) {\n    if (er) return cb(er);\n\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids.filter(function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid);\n    });\n    kids.push.apply(kids, scopekids.map(function (scopekid) {\n      return scope + '/' + scopekid;\n    }));\n    debug('scope=%j scopekids=%j kids=%j', scope, scopekids, kids);\n    if (--l === 0) cb(null, kids);\n  }\n}\nfunction readScopesSync(root, kids) {\n  var scopes = kids.filter(function (kid) {\n    return kid.charAt(0) === '@';\n  });\n  kids = kids.filter(function (kid) {\n    return kid.charAt(0) !== '@';\n  });\n  debug('scopes=%j', scopes);\n  if (scopes.length === 0) return kids;\n  var l = scopes.length;\n  scopes.forEach(function (scope) {\n    var scopedir = path.resolve(root, scope);\n    debug('root=%j scope=%j scopedir=%j', root, scope, scopedir);\n    then(scope, fs.readdirSync(scopedir));\n  });\n  function then(scope, scopekids) {\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids.filter(function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid);\n    });\n    kids.push.apply(kids, scopekids.map(function (scopekid) {\n      return scope + '/' + scopekid;\n    }));\n    debug('scope=%j scopekids=%j kids=%j', scope, scopekids, kids);\n  }\n  return kids;\n}","map":{"version":3,"names":["fs","require","dz","once","path","debug","module","exports","readdir","sync","readdirSync","dir","cb","er","kids","readScopes","data","sort","a","b","readScopesSync","root","scopes","filter","kid","charAt","length","l","forEach","scope","scopedir","resolve","then","bind","scopekids","scopekid","push","apply","map"],"sources":["/Users/hkateliev/node_modules/npm/node_modules/readdir-scoped-modules/readdir.js"],"sourcesContent":["var fs = require ('graceful-fs')\nvar dz = require ('dezalgo')\nvar once = require ('once')\nvar path = require ('path')\nvar debug = require ('debuglog') ('rds')\n\nmodule . exports = readdir\nreaddir.sync = readdirSync\n\nfunction readdir (dir, cb) {\n  fs . readdir (dir, function (er, kids) {\n    if (er)\n      return cb (er)\n\n    debug ('dir=%j, kids=%j', dir, kids)\n    readScopes (dir, kids, function (er, data) {\n      if (er)\n        return cb (er)\n\n      // Sort for bonus consistency points\n      data = data . sort (function (a, b) {\n        return a > b ? 1 : -1\n      })\n\n      return cb (null, data)\n    })\n  })\n}\n\nfunction readdirSync (dir) {\n  var kids = fs . readdirSync (dir)\n  debug ('dir=%j, kids=%j', dir, kids)\n  var data =  readScopesSync (dir, kids)\n  // Sort for bonus consistency points\n  data = data . sort (function (a, b) {\n    return a > b ? 1 : -1\n  })\n\n  return data\n}\n\n// Turn [ 'a', '@scope' ] into\n// ['a', '@scope/foo', '@scope/bar']\nfunction readScopes (root, kids, cb) {\n  var scopes = kids . filter (function (kid) {\n    return kid . charAt (0) === '@'\n  })\n\n  kids = kids . filter (function (kid) {\n    return kid . charAt (0) !== '@'\n  })\n\n  debug ('scopes=%j', scopes)\n\n  if (scopes . length === 0)\n    dz (cb) (null, kids) // prevent maybe-sync zalgo release\n\n  cb = once (cb)\n  var l = scopes . length\n  scopes . forEach (function (scope) {\n    var scopedir = path . resolve (root, scope)\n    debug ('root=%j scope=%j scopedir=%j', root, scope, scopedir)\n    fs . readdir (scopedir, then . bind (null, scope))\n  })\n\n  function then (scope, er, scopekids) {\n    if (er)\n      return cb (er)\n\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids . filter (function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid)\n    })\n\n    kids . push . apply (kids, scopekids . map (function (scopekid) {\n      return scope + '/' + scopekid\n    }))\n\n    debug ('scope=%j scopekids=%j kids=%j', scope, scopekids, kids)\n\n    if (--l === 0)\n      cb (null, kids)\n  }\n}\n\nfunction readScopesSync (root, kids) {\n  var scopes = kids . filter (function (kid) {\n    return kid . charAt (0) === '@'\n  })\n\n  kids = kids . filter (function (kid) {\n    return kid . charAt (0) !== '@'\n  })\n\n  debug ('scopes=%j', scopes)\n\n  if (scopes . length === 0)\n    return kids\n\n  var l = scopes . length\n  scopes . forEach (function (scope) {\n    var scopedir = path . resolve (root, scope)\n    debug ('root=%j scope=%j scopedir=%j', root, scope, scopedir)\n    then (scope, fs . readdirSync (scopedir))\n  })\n\n  function then (scope, scopekids) {\n    // XXX: Not sure how old this node bug is. Maybe superstition?\n    scopekids = scopekids . filter (function (scopekid) {\n      return !(scopekid === '.' || scopekid === '..' || !scopekid)\n    })\n\n    kids . push . apply (kids, scopekids . map (function (scopekid) {\n      return scope + '/' + scopekid\n    }))\n\n    debug ('scope=%j scopekids=%j kids=%j', scope, scopekids, kids)\n  }\n\n  return kids\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}